
<html>
<head>
<meta http-equiv=Content-Type content="text/html; charset=windows-1251">
<title>1С-Предприятие. Документация | Управление распределенными ИБ. Глава 7.</title>
<link rel="stylesheet" type="text/css" href="../1c.css">
</head>
<body background="../images/background_main.gif"> <div> 
  <h3><a name="___Toc485062721">Глава 7</a></h3>
  <h3><a name="_Toc485063186">Методические рекомендации по конфигурированию системы 
    1С:Предприятия для работы с распределенной информационной базой</a></h3>
  <h4><a name="_Toc485062723"></a><a name="_Toc485063187">Номера документов и 
    коды элементов справочнико</a>в</h4>
  <p>Синхронизация «ведущих» объектов распределенной информационной 
    базы происходит в процессе обмена файлами переноса данных, в промежутках между 
    обменами каждая ИБ работает автономно. Это может привести к тому, что созданному 
    на одной из ИБ документу будет присвоен уникальный в пределах данной ИБ номер, 
    который окажется не уникальным для всей распределенной информационной базы 
    в целом. В таком случае, после обмена файлами переноса данных, в распределенной 
    ИБ могут образоваться два (или больше) документа с одинаковыми номерами, даже 
    если в свойствах номера документа установлены признаки «Контроль уникальности» 
    и «Автоматическая нумерация». Аналогичная ситуация может возникнуть и для 
    кода вновь созданного элемента справочника.</p>
  <p>Рекомендуемый способ решения этой 
    проблемы состоит в использовании префиксов номеров документов и кодов элементов 
    справочников. В свойствах номера или кода при конфигурировании следует установить 
    тип «Текстовый». В качестве префикса можно использовать значение локальной 
    константы или код информационной базы. В случае использования локальной константы 
    следует обеспечить уникальность ее значения для каждой ИБ в пределах распределенной 
    ИБ. Если используется код информационной базы, уникальность обеспечивается 
    автоматически, так как в одной информационной базе не может быть двух ИБ с 
    одинаковым кодом - система следит за этим.</p>
  <p>Для документов и справочников, имеющих 
    свойство миграции «Место создания», обеспечивать уникальность номера или кода 
    в пределах всей распределенной информационной базы не обязательно.</p>
  <p><b>Пример:</b></p>
  <p>// Установку префиксов производим в процедуре </p>
  <p>// ПриКачалеРаботыСистемы глобального модуля </p>
  <p>Процедура ПриНачалеРаботыСистемы() // Установка префиксов автонумерации 
    </p>
  <p>КодИБ = ТекущаяИБКодО ; // Использование кода ИБ ПрефиксАвтоНумерации(&quot;Справочник.Тов<sup>7</sup>' 
    </p>
  <p>// Использование значения локальной :•. </p>
  <p>ПрефиксАвтоНумерации( &quot;С-' --.--•--.&quot;•/ <i>'•••-</i></p>
  <p align=right>Константа. <i>Т.о'т ~ /I</i> Использование 
    кода :::</p>
  <p>ПрефиксАвтоНумерации(•Г</p>
  <p>КонецПроцедуры</p>
  <h4><a name="_Toc485062724"></a><a name="_Toc485063188">Методы исключения коллизи</a>й</h4>
  <p>Компонента «Управление распределенными ИБ» обрабатывает спорные 
    ситуации, возникающие в процессе работы распределенной информационной базы 
    (см. «Принципы разрешения спорных ситуаций»). Однако возникновение коллизий 
    остается нежелательным и их, по возможности, следует избегать.</p>
  <p>Спорные ситуации не будут возникать 
    в том случае, если редактирование и удаление «ведущего» объекта доступно только 
    на одной из ИБ распределенной информационной базы. Достичь этого можно несколькими 
    путями.</p>
  <h5><a name="_Toc485062725"></a><a name="_Toc485063189">Настройка пользовательского 
    интерфейс</a>а</h5>
  <p>Метод состоит в создании пользовательских интерфейсов, которые 
    дают доступ только к «безопасным» с точки зрения возникновения коллизий командам 
    системы. Например, интерфейс дает возможность пользователю только вводить 
    новые документы. К сожалению, даже такие ограничения не являются гарантией 
    от возникновения спорных ситуаций (см. ниже).</p>
  <p>При использовании данного метода следует иметь в виду, что:</p>
  <p>• доступ к корректировке и удалению 
    «ведущих» объектов можно получить не только через пользовательский интерфейс. 
    Например, если документ имеет реквизит типа «Справочник», то при вводе нового 
    документа будет вызвана форма списка справочника, пользователь получает доступ 
    к редактированию и удалению его элементов, и интерфейс перестает быть «безопасным»;</p>
  <p>• метод не позволяет разрешать редактирование 
    и удаление данных выборочно, в зависимости от ИБ, на которой выполняется 1С:Предприятие;</p>
  <p>• па всех ИБ, кроме одной, должны 
    быть зарегистрированы пользователи, имеющие только «безопасные» интерфейсы, 
    что не всегда возможно в реальной ситуации;</p>
  <p>• интерфейсы являются частью конфигурации 
    и мигрируют все вместе, как «безопасные», так и «небезопасные». Поэтому, разработчик 
    конфигурации не гарантирован, что администратор системы не назначит пользователям 
    двух и более ЦБ, входящих в состав распределенной И Б, «небезопасные» интерфейсы.</p>
  <p>Таким образом, применение данного 
    метода накладывает существенные ограничения, он может быть рекомендован лишь 
    в Простых случаях.</p>
  <h5><a name="_Toc485062726"></a><a name="_Toc485063190">Настройка прав доступ</a>а</h5>
  <p>Настройка прав доступа к данным является более гибким средством 
    для предотвращения коллизий, чем настройка пользовательских интерфейсов. Обеспечив 
    с их помощью ситуацию, в которой любой «ведущий» объект системы может быть 
    отредактирован или удален не более чем на одной ИБ, администратор добьется 
    предотвращения возникновения коллизий.</p>
  <p>Применение данного метода позволяет 
    избежать некоторых ограничений, накладываемых методом настройки пользовательских 
    интерфейсов. Однако следует иметь в виду:</p>
  <p>• метод не позволяет разрешать редактирование 
    и удаление данных выборочно, в зависимости от И Б, на которой выполняется 
    1 С:Предприятие;</p>
  <p>• права доступа являются частью конфигурации и мигрируют все 
    вместе, как «безопасные», так и «небезопасные». Поэтому разработчик конфигурации 
    не гарантирован, что администратор системы не назначит пользователям двух 
    и более ИБ, входя щи в состав распределенной ИБ, «небезопасные» права;</p>
  <p>• возможность возникновения коллизий 
    определяется не составом ИБ (что можно считать постоянным), а составом условно 
    одновременно работающих пользователей (а, точнее, совокупность их прав доступа 
    к данным). В силу этого обстоятельства безопасность зависит не от разработчика, 
    а от администратора.</p>
  <p>Заметим, что проблему с администрированием системы 
    на периферийной ИБ можно решить, используя возможность проверки в глобальном 
    модуле при запуске системы набора прав, с которым пользователь входит в систему: 
    то есть в конфигурации можно исключить возможность запуска системы на периферийной 
    ИБ с набором прав который не содержит требуемых ограничений. Возможность защит! 
    конфигурации паролем позволяет предотвратить также и возможны случаи умышленной 
    попытки обойти это ограничение на периферий ной ИБ.</p>
  <h5><a name="_Toc485062727"></a><a name="_Toc485063191">Использование средств 
    встроенного язык</a>а</h5>
  <p>Этот метод является наиболее гибким, а в ряде случаев, 
    и мене трудоемким для разработчика, чем перечисленные выше. Суть его сводится 
    к установке обработчиков действий пользователя, связанны с редактированием 
    и/или удалением «ведущих» объектов, и, на основании доступной с помощью специальных 
    функций информации принятия решения о разрешении или запрещении этого действия.</p>
  <p>В таблице приведены некоторые примеры 
    системных предопределенных процедур, предназначенных для «перехвата» действий 
    пользователя.</p>
  <table border=1 cellspacing=0 cellpadding=0 width="100%">
    <tr> 
      <td valign=top> 
        <p><b>Процедура      </b></p>
      </td>
      <td valign=top> 
        <p><b>Перехватываемое действие</b></p>
      </td>
    </tr>
    <tr> 
      <td valign=top> 
        <p>ПриУдаленииДокумента</p>
      </td>
      <td valign=top> 
        <p>Удаление пользователем документа</p>
      </td>
    </tr>
    <tr> 
      <td valign=top> 
        <p>ПриУдаленииЭлемекта </p>
      </td>
      <td valign=top> 
        <p>Удаление пользователем элемент 
          справочника</p>
      </td>
    </tr>
    <tr> 
      <td valign=top> 
        <p>ПриУдаленииСчета  </p>
      </td>
      <td valign=top> 
        <p>Удаление пользователем бухгалтерского 
          счета</p>
      </td>
    </tr>
    <tr> 
      <td valign=top> 
        <p>ПриЗаписиКонстанты </p>
      </td>
      <td valign=top> 
        <p>Изменение значения константы</p>
      </td>
    </tr>
    <tr> 
      <td valign=top> 
        <p>ПриОткрытии     </p>
      </td>
      <td valign=top> 
        <p>Открытие формы элемента справочника, 
          документа или счета. Функция Выбран() должна вернуть 1, если форма открывается 
          для редактирования.</p>
      </td>
    </tr>
  </table>
  <p>&nbsp;<b>         </b></p>
  <p>Описание этих процедур, а также процедур и функций, приведенных 
    ниже, смотрите в книге «1С:Предприятие. Описание встроенного языка».</p>
  <p>Запретить или разрешить перехваченное действие пользователя 
    возможно на основании обширного набора информации:</p>
  <p>• место создания объекта;</p>
  <p>• И Б, на которой исполняется 1:Предприятие;</p>
  <p>• используемый интерфейс пользователя:</p>
  <p>• название прав доступа.</p>
  <p>Также допустимо использование любой комбинации этих данных, что 
    обеспечивает максимальную гибкость в настройке конфигурации для исключения 
    коллизий.</p>
  <p>Запретить выполнение перехваченного 
    действия можно с помощью процедуры СтатусВоз врата с параметром 0 (ноль). 
    Если эту процедуру использовать в системной предопределенной процедуре ПриОткрытии, 
    то форма не откроется вообще, для открытия формы только для просмотра используйте 
    процедуру ТолькоПросмотр с параметром 1.</p>
  <p><b>Примеры:</b></p>
  <p>// Корректировка значения константы &quot;Директор&quot; разрешено</p>
  <p>// только на 
    центральной ИБ</p>
  <p>Процедура ПриЗаписиКонстанты( 
    Наин, Знач)</p>
  <p>Если (ТекущаяИБЦентралькая() -= 0) И (Наим - &quot;Директ- ,&quot;'' 
    Тогда</p>
  <p>Сообщ ^ &quot;Имя директора можно поменять только 
    в центре!*;</p>
  <p>Предупреждение(Сообщ, 
    2);</p>
  <p>СтатусВозврата(0);</p>
  <p>КонецЕсли;</p>
  <p>КонецПроцедуры</p>
  <h4><a name="_Toc485062728"></a><a name="_Toc485063192">Методы исключения некорректного 
    использования свойств миграци</a>и</h4>
  <p>Как уже отмечалось ранее, вводя ограничения Миграции «ведущих» 
    объектов, следует четко представлять себе последствия, к которым это может 
    привести. При этом нужно обратить внимание на следующее.</p>
  <p>Ссылочная целостность. «Ведущие» объекты, имеющие ссылки, 
    как правило, имеют равную или более ограниченную миграцию, чем объекты, на 
    которые имеют ссылку.</p>
  <p><i>Особые свойства объекта типа «Документ».</i> Миграция 
    объектов типа «Документ» происходит вместе со всеми изменениями, произведенными 
    им. Обычно, объекты, используемые в изменениях (например, измерения регистров 
    или реквизиты проводок, используемых документом при проведении) должны иметь 
    миграцию, большую или равную миграции документа.</p>
  <p><i>Особые свойства объекта типа «Счет».</i> Миграция объектов 
    типа «Счет» настраивается для всего плана счетов в целом. Кроме того, счета, 
    заданные в метаданных, распространяются на все периферийные ИБ вне зависимости 
    от свойств миграции.</p>
  <p>Заметим, что, в отличии от других объектов, свойства объектов 
    типа «Счет» оказывают сильное влияние на другие данные - бухгалтерские операции 
    и бухгалтерские итоги. Изменение настроек учета счетов (валютного, количественного, 
    аналитического учета) влечет за собой пересчет бухгалтерских итогов и, если 
    необходимо, корректировку проводок. Кроме того, счета в плане счетов более 
    взаимосвязаны, чем, например, элементы справочника, и образуют целостную систему.</p>
  <p>Вследствие этого, имеет смысл с особым вниманием отнестись 
    к настройке свойств миграции и прав доступа планов счетов. В большинстве случаев 
    рекомендуется средствами конфигурации запретить изменение счетов на периферийных 
    информационных базах (при этом в свойствах миграции можно установить режим 
    «Все информационные базы»).</p>
</div>
<center>
<hr class="std">
  <a href="urbd00.html"><img src="images/oglav.gif" border="0" alt="Перейти  к оглавлению: Управление распределенными ИБ" width="113" height="19"></a> 
</center>
  </body>
</html>
