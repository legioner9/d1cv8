
<html>
<head>
<meta http-equiv=Content-Type content="text/html; charset=windows-1251">
<title>1С-Предприятие. Документация | Технология создания внешних компонент. Часть 
1 - Внешние компоненты</title>
<link rel="stylesheet" type="text/css" href="../../../1c.css">
<style><!--
h1 {  font-size: 14pt; text-align: center}
h2 {  font-size: 12pt; text-align: center}
h3 {  font-size: 10pt}
-->
</style>
</head>
<body lang=RU link=#0000FF vlink=#800080 background="../../../images/background_main.gif">
<h1 class="highlink"><font size="4">Часть 1. Внешние компоненты</font></h1>
<hr>
<ul>
  <li><a href="#_toc502332880">Внешние компоненты</a></li>
  <li><a href="#_toc502332881">Средства встроенного языка 1С:Предприятия, 
    предназначенные для работы с внешними компонентами.</a> 
    <ul>
      <li><a href="#_toc502332882">ЗагрузитьВнешнююКомпоненту</a></li>
      <li><a href="#_toc502332883">ПодключитьВнешнююКомпоненту</a></li>
      <li><a href="#_toc502332884">ОбработкаВнешнегоСобытия</a></li>
    </ul>
  </li>
  <li><a href="#_toc502332885">Разработка внешней компоненты</a> 
    <ul>
      <li><a href="#_toc502332886">Создание OLE-объекта внешней компоненты</a></li>
      <li><a href="#_toc502332887">Инициализация и выгрузка компоненты</a> 
        <ul>
          <li><a href="#_toc502332888">HRESULT Init(IDispatch 
            *pBackConnection)</a></li>
          <li><a href="#_toc502332889">HRESULT Done(void)</a></li>
          <li><a href="#_toc502332890">HRESULT GetInfo(SAFEARRAY 
            **pInfo)</a></li>
        </ul>
      </li>
    </ul>
  </li>
  <li><a href="#_toc502332891">Страница свойств</a></li>
  <li><a href="#_toc502332892">Расширение встроенного языка</a> 
    <ul>
      <li><a href="#_toc502332893">HRESULT RegisterExtensionAs(BSTR 
        *pExtensionName):</a></li>
    </ul>
  </li>
  <li><a href="#_toc502332894">Свойства расширения</a> 
    <ul>
      <li><a href="#_toc502332895">HRESULT GetNProps(long 
        *plProps)</a></li>
      <li><a href="#_toc502332896">HRESULT FindProp(BSTR 
        pszPropName,long*plPropNum)</a></li>
      <li><a href="#_toc502332897">HRESULT GetPropName(long 
        lPropNum,long lAliasNum,BSTR *pPropName)</a></li>
      <li><a href="#_toc502332898">HRESULT GetPropVal(long 
        lPropNum,VARIANT *pvPropVal)</a></li>
      <li><a href="#_toc502332899">HRESULT SetPropVal(long 
        lPropNum, VARIANT *pvPropVal)</a></li>
      <li><a href="#_toc502332900">HRESULT IsPropReadable(long 
        lPropNum, BOOL *pboolPropReadable)</a></li>
      <li><a href="#_toc502332901">HRESULT IsPropWritable(long 
        lPropNum, BOOL *pboolPropWritable)</a></li>
    </ul>
  </li>
  <li><a href="#_toc502332902">Методы расширения</a> 
    <ul>
      <li><a href="#_toc502332903">HRESULT GetNMethods(long 
        *plMethods)</a></li>
      <li><a href="#_toc502332904">HRESULT FindMethod(BSTR 
        bstrMethodName,long *plMethNum)</a></li>
      <li><a href="#_toc502332905">HRESULT GetMethodName(long lMethodNum, long 
        lAliasNum,BSTR  *pbstrMethName)</a></li>
      <li><a href="#_toc502332906">HRESULT GetNParams(long 
        lMethodNum, long *plMethParams)</a></li>
      <li><a href="#_toc502332907">HRESULT GetParamDefValue(long 
        lMethodNum, long lParamNum,VARIANT *pvParamDefVal)</a></li>
      <li><a href="#_toc502332908">HRESULT HasRetVal(long 
        lMethodNum,BOOL *pboolHasRetVal)</a></li>
      <li><a href="#_toc502332909">HRESULT CallAsProc(long 
        lMethodNum, SAFEARRAY **pVars)</a></li>
      <li><a href="#_toc502332910">HRESULT CallAsFunc(long 
        lMethodNum, VARIANT *pRetValue, SAFEARRAY**pVars)</a></li>
    </ul>
  </li>
  <li><a href="#_toc502332911">Использование типа OLE VARIANT при 
    обмене данными</a></li>
  <li><a href="#_toc502332912">Вызов функции компоненты</a></li>
  <li><a href="#_toc502332913">Возвращение значений из компоненты</a></li>
  <li><a href="#_toc502332914">Вызов метода объекта 1С:Предприятия 
    из компоненты</a></li>
  <li><a href="#_toc502332915">OLE интерфейсы 1C:Предприятия</a> </li>
  <li><a href="#_toc502332916">Сохранение параметров объекта компоненты</a> 
    <ul>
      <li><a href="#_toc502332917">HRESULT RegisterProfileAs(BSTR 
        bstrProfileName)</a></li>
    </ul>
  </li>
  <li><a href="#_toc502332918">Информационные сообщения о работе 
    объекта</a> 
    <ul>
      <li><a href="#_toc502332919">HRESULT AddError(BSTR 
        pszPropName, LPEXCEPINFO pExcepInfo)</a></li>
    </ul>
  </li>
  <li><a href="#_toc502332920">Внешние события</a> 
    <ul>
      <li><a href="#_toc502332921">HRESULT SetEventBufferDepth(long 
        lDepth)</a></li>
      <li><a href="#_toc502332922">HRESULT 
        GetEventBufferDepth(long 
        *plDepth)</a></li>
      <li><a href="#_toc502332923">HRESULT ExternalEvent(BSTR 
        bstrWho, BSTR bstrWhat, BSTR bstrData)</a></li>
      <li><a href="#_toc502332924">HRESULT CleanBuffer()</a></li>
    </ul>
  </li>
  <li><a href="#_toc502332925">Работа с строкой состояния</a> 
    <ul>
      <li><a href="#_toc502332926">HRESULT SetStatusLine(BSTR 
        bstrStatusText)</a></li>
      <li><a href="#_toc502332927">HRESULT ResetStatusLine()</a></li>
    </ul>
  </li>
  <li><a href="#_toc502332928">Создание окон в среде 1С:Предприятия</a> 
    <ul>
      <li><a href="#_toc502332929">Модальные диалоги</a></li>
      <li><a href="#_toc502332930">Немодальные диалоги</a></li>
      <li><a href="#_toc502332931">Формы</a></li>
      <li><a href="#_toc502332932">HRESULT GetAppMainFrame(HWND 
        *pHWnd)</a></li>
      <li><a href="#_toc502332933">HRESULT GetAppMDIFrame(HWND 
        *pHWnd)</a></li>
      <li><a href="#_toc502332934">HRESULT CreateAddInWindow(BSTR bstrProgID, 
        BSTR bstrTitle, long lStyles,long lExStyles, RECT *rctSize, long lFlags, 
        HWND *pHwnd, IDispatch   **pDisp)</a></li>
    </ul>
  </li>
  <li><a href="#_toc502332935">Доступ к 1С:Предприятию через механизм 
    OLE Automation</a></li>
  <li><a href="#_toc502332936">Доступ к методам интерфейсов 1С:Предприятия 
    через OLE Automation</a></li>
</ul>
<h1><a name="_Toc502332880">Внешние компоненты</a></h1>
<p>Внешняя 
  компонента -программный модуль, расширяющий функциональность 1С:Предприятия. 
  Внешние компоненты являются OLE серверами и вследствие этого могут быть написаны 
  с использованием произвольных инструментов разработки программ, поддерживающих 
  создание OLE объектов.</p>
<p>Возможности 
  внешней компоненты:</p>
<ul>
  <li>расширение встроенного 
    языка 1С:Предприятия (добавление новых агрегатных объектов);</li>
  <li>добавление страницы 
    свойств в параметры 1С:Предприятия;</li>
  <li>сохранение параметров 
    внешней компоненты через механизмы сохранения параметров 
    1С:Предприятия;</li>
  <li>создание дополнительных 
    окон в окне 1С:Предприятия (версия 2.0);</li>
  <li>доступ к функциям 
    1С:Предприятия через OLE Automation (версия 2.0);</li>
  <li>вызов процедуры 
    обработки событий, контролируемых внешней компонентой;</li>
  <li>доступ к строке 
    состояния 1С:Предприятия.</li>
</ul>
<p>Внешние 
  компоненты используются в 1С:Предприятии для расширения его возможностей при 
  выполнении различных задач. В частности, в число таких задач входит вызов функции 
  из библиотеки (DLL), использование различного торгового оборудования, нестандартное 
  отображение данных и т.д. Все</p>
<p>внешние 
  компоненты следуют единому стандарту, поэтому при работе можно использовать 
  как уже существующие компоненты, так и разрабатывать новые. В данную поставку 
  входят шаблоны и примеры для различных сред программирования, которые позволяют 
  упростить разработку новых компонент.</p>
<h1><a name="_Toc502332881">Средства встроенного языка 1С:Предприятия, предназначенные 
  для работы с внешними компонентами.</a></h1>
<h3><a name="_Toc502332882">ЗагрузитьВнешнююКомпоненту</a></h3>
<p>Загружает 
  внешнюю компоненту, создает соответствующие OLE объекты и подключает их к 1С:Предприятию 
  .</p>
<p><b>Синтаксис:</b></p>
<p>ЗагрузитьВнешнююКомпоненту 
  ( &lt;ИмяФайлаКомпоненты&gt;)</p>
<p><b>Англоязычный синоним:</b></p>
<p>LoadAddIn</p>
<p><b>Параметры:</b></p>
<table>
  <tr> 
    <td> <i>ИмяФайлаКомпоненты</i></td>
    <td> 
      <p>имя файла внешней компоненты.      ИмяФайлаКомпоненты 
        иметь вид  &quot;Имя.Расширение&quot; и не должно содержатьпуть. Файл 
        компоненты ищется последовательно в каталоге пользователя, в каталоге 
        информационной базы, и в каталоге c исполняемым файлом 1С:Предприятия.             
      </p>
    </td>
  </tr>
</table>
<p><b>Возвращаемое значение:</b></p>
<p>0 
  - при загрузке компоненты произошла ошибка</p>
<p>1 
  - компонента успешно загружена</p>
<p><b>Описание:</b></p>
<p>Внешние компоненты загружаются функцией встроенного 
  языкаЗагрузитьВнешнююКомпоненту. Файл  внешней компоненты должен быть динамически 
  загружаемой библиотекой (например, DLL или OCX), то есть работать как InProc 
  сервер. При загрузке внешней компоненты 1С:Предприятие вызывает функцию, если 
  она экспортирована из внешней компоненты. Это позволяет просто переносить  компоненты 
  между компьютерами без дополнительной регистрации их как OLE серверов. При возникновении 
  ошибок при загрузке 1С:Предприятие выдает информацию об ошибке в окно сообщений.</p>
<p>О создании OLE объекта внешней компоненты при загрузке 
  - см. Разработка внешней компоненты, стр.  * . </p>
<h3><a name="_Toc502332883">ПодключитьВнешнююКомпоненту</a></h3>
<p>Создает 
  OLE объекты внешней компоненты и подключает их к 1С:Предприятию.</p>
<p><b>Синтаксис:</b></p>
<p>ПодключитьВнешнююКомпоненту 
  ( &lt;ИмяОбъектаКомпоненты&gt;)</p>
<p><b>Англоязычный синоним:</b></p>
<p>AttachAddIn</p>
<p><b>Параметры:</b></p>
<table>
  <tr> 
    <td>       <i>ИмяОбъектаКомпоненты</i>    </td>
    <td> 
      <p>ProgID (Programmatic Id 
        entifier) объекта внешней компоненты. ИмяОбъектаКомпоненты  должно   
        соответствовать информации, находящейся в регистрационной базе данных 
        системы (Registry).    </p>
    </td>
  </tr>
</table>
<p><b>Возвращаемое значение:</b></p>
<p>0 
  - при подключении компоненты произошла ошибка</p>
<p>1 
  - компонента успешно подключена</p>
<p><b>Описание:</b></p>
<p>Внешние 
  компоненты подключаются функцией встроенного языка ПодключитьВнешнююКомпоненту 
  . Внешняя компонента может быть как динамически загружаемой библиотекой (например, 
  DLL или OCX), так и приложением. При возникновении ошибок при подключении 1С:Предприятие 
  выдает информацию об ошибке в окно сообщений.</p>
<h3><a name="_Toc502332884">ОбработкаВнешнегоСобытия</a></h3>
<p>Предопределенная 
  процедура встроенного языка. Вызывается при возникновении сообщения от внешней 
  компоненты.</p>
<p><b>Синтаксис:</b></p>
<p>ОбработкаВнешнегоСобытия( 
  &lt; Источник&gt;, &lt;Событие&gt;, &lt;Данные&gt; )</p>
<p><b>Англоязычный синоним:</b></p>
<p>ExternEventProcessing</p>
<p><b>Параметры:</b></p>
<table>
  <tr> 
    <td> 
      <i>Источник</i>
    </td>
    <td> 
      <p>строка 
        с наименованием источника сообщения.</p>
    </td>
  </tr>
  <tr> 
    <td>       <i>Событие</i>    </td>
    <td> 
      <p>строка 
        с наименованием сообщения.</p>
    </td>
  </tr>
  <tr> 
    <td> 
      <i>Данные</i>
    </td>
    <td> 
      <p>строка 
        с параметрами сообщения.</p>
    </td>
  </tr>
</table>
<p><b>Возвращаемое значение:</b></p>
<p>отсутствует</p>
<p><b>Описание:</b></p>
<p>Процедура 
  ОбработкаВнешнегоСобытия - предопределенная процедура обработки сообщений от 
  внешних компонент.</p>
<p>Процедура 
  может быть описана в любом модуле системы 1С:Предприятие. При получении сообщения 
  будет вызвана процедура ОбработкаВнешнегоСобытия, определенная в модуле активной 
  на этот момент формы. Если в этом модуле процедура ОбработкаВнешнегоСобытия 
  не определена, то будет вызвана процедура ОбработкаВнешнегоСобытия , определенная 
  в глобальном модуле. Если в глобальном модуле процедура ОбработкаВнешнегоСобытия 
  отсутствует, будет выдано сообщение об отсутствии процедуры ОбработкаВнешнегоСобытия 
  . Процедура ОбработкаВнешнегоСобытия в глобальном модуле не ызывается,</p>
<p>если 
  событие обработано в модуле активной формы.</p>
<table>
  <tr bgcolor="#FFFFCC"> 
    <td> 
      <p>Вызов 
        этой процедуры синхронизирован с обработкой сообщений системой 1С:Предприятие 
        и происходит только при отсутствии других выполняемых системой операций 
        (проведении документов, построении отчетов и т.д.).</p>
    </td>
  </tr>
</table>
<h1><a name="_Toc502332885">Разработка внешней компоненты</a></h1>
<h2><a name="_Toc502332886">Создание OLE-объекта внешней компоненты</a></h2>
<p>При загрузке внешней компоненты функцией ЗагрузитьВнешнююКомпоненту 1С:Предприятие 
  определяет ProgID OLE-объекта компоненты следующим образом: </p>
<p>ProgID имеет вид &lt;Vendor&gt;.&lt;Component&gt;;</p>
<p>в 
  качестве первой части (&lt;Vendor&gt;) используется строка &quot;AddIn&quot;;</p>
<p>в качестве второй части (&lt;Component&gt;) используется строка с ID 100 из 
  таблицы строк компоненты. Cтрока может иметь вид &quot;Name1|Name2|...|NameN&quot;, 
  и в этом случае будут созданы все объекты с ProgID вида &quot;AddIn.NameX&quot;. 
  Если такая строка отсутствует, то используется имя файла внешней компоненты 
  без расширения.</p>
<p>При использовании функции ПодключитьВнешнююКомпоненту ProgID OLE-объекта компоненты 
  передается в качестве параметра функции и также может представляться строкой 
  вида ProgID1| ProgID2|...|ProgIDX.</p>
<h2><a name="_Toc502332887">Инициализация и выгрузка компоненты</a></h2>
<p>Для 
  инициализации и выгрузки компоненты используется интерфейс IInitDone. Этот интерфейс 
  наследован от IUnknown и предназначен для инициализации объекта и завершения 
  работы с объектом.</p>
<h3><a name="_Toc502332888">HRESULT Init(IDispatch *pBackConnection)</a></h3>
<p><b>Параметры:</b></p>
<table>
  <tr> 
    <td>       <i>pBackConnection</i>             </td>
    <td> 
      <p>указатель 
        на интерфейс 1С:Предприятия.</p>
    </td>
  </tr>
</table>
<p><b>Возвращаемое значение:</b></p>
<p>E_FAIL 
  - при инициализации произошла ошибка</p>
<p>S_OK 
  - инициализация прошла успешно</p>
<p><b>Описание:</b></p>
<p>При 
  загрузке 1С:Предприятие инициализирует объект компоненты, вызывая метод Init 
  и передавая указатель на IDispatch. Объект не должен вызывать Release этого 
  интерфейса, но может сохранить этот указатель для дальнейшего использования. 
  Все остальные интерфейсы 1С:Предприятия объект может получить, вызвав метод 
  QueryInterface переданного ему интерфейса IDispatch. Объект должен возвратить 
  S_OK, если инициализация прошла успешно, и E_FAIL при возникновении ошибки. 
  Данный метод может использовать интерфейс IErrorLog (см. стр. * ) для вывода 
  информации об ошибках. При этом инициализация считается неудачной, если одна 
  из переданных структур EXCEPINFO имеет поле scode, не равное S_OK. Все переданные 
  в IErrorLog данные обрабатываются при возврате из данного метода. В момент вызова 
  этого метода свойство AppDispatch не определено.</p>
<h3><a name="_Toc502332889">HRESULT Done(void)</a></h3>
<p><b>Параметры:</b></p>
<p>отсутствуют</p>
<p><b>Возвращаемое значение:</b></p>
<p>S_OK 
  - объект завершил работу</p>
<p><b>Описание:</b></p>
<p>1С:Предприятие 
  вызывает этот метод при завершении работы с объектом компоненты. Объект должен 
  возвратить S_OK. Этот метод вызывается независимо от результата инициализации 
  объекта (метод Init).</p>
<h3><a name="_Toc502332890">HRESULT GetInfo(SAFEARRAY **pInfo)</a></h3>
<p><b>Параметры:</b></p>
<table>
  <tr> 
    <td>       <i>pInfo</i>    </td>
    <td> 
      <p>Двойной 
        указатель на массив структур VARIANT . Память для массива выделяется 1С:Предприятием.</p>
    </td>
  </tr>
</table>
<p><b>Возвращаемое значение:</b></p>
<p>S_OK 
  - информация о компоненте возвращена</p>
<p><b>Описание:</b></p>
<p>1С:Предприятие вызывает этот метод для получения 
  информации о компоненте. В текущей версии 2.0 компонентной технологии в элемент  
  с индексом 0 необходимо записать версию поддерживаемой компонентной технологии 
  в формате V_I4 - целого числа, при этом старший номер версии записывается в 
  тысячные разряды, младший номер версии - в единицы. Например: версия 3.56 - 
  число 3560. В настоящее время все объекты внешних компонент могут поддерживать 
  версию 1.0 (соответствует числу 1000) или 2.0 (соответствует 2000). Память для 
  pInfo выделяется 1С:Предприятием. Метод должен возвращать S_OK.</p>
<table>
  <tr bgcolor="#FFFFCC"> 
    <td> 
      <p>Объект 
        внешней компоненты обязан реализовать этот интерфейс. При его отсутствии 
        компонента не будет загружена.</p>
    </td>
  </tr>
</table>
<h2><a name="_Toc502332891">Страница свойств</a></h2>
<p>Для добавления страницы свойств объекта компоненты 
  в диалог настройки параметров 1С:Предприятия используются интерфейсы IPropertyPage 
  или ISpecifyPropertyPages (объект может реализовать любой из этих интерфейсов). 
  Каждый объект может добавитьодну страницу свойств. Странице свойств при инициализации 
  передается указатель на интерфейс Iunknown соответствующего объекта внешней 
  компоненты. Интерфейсы  IPropertyPage, ISupplyPropertyPages являются стандартными 
  для OLE, поэтому их описание Вы сможете найти в документации на OLE и книгах, 
  приводимых в списке</p>
<p>литературы.</p>
<h2><a name="_Toc502332892">Расширение встроенного языка</a></h2>
<p>Для расширения встроенного языка компонента должна 
  реализовать интерфейс ILanguageExtender . Этот интерфейс унаследован от IUnknown 
  и предназначен для расширения встроенного языка 1С:Предприятия. Для использования 
  этого расширения необходимо вызвать функцию СоздатьОбъект, передав ей строку 
  вида &quot;AddIn._ИмяРасширения_&quot;, где _ИмяРасширения_ возвращается методом 
  этого интерфейса  Затем можно использовать созданный объект, вызывая его методы 
  и свойства.</p>
<table>
  <tr bgcolor="#FFFFCC"> 
    <td> 
      <p>В отличие от предыдущей версии версия 2.0 
        позволяет создавать несколько объектов одного типа &quot;AddIn._ИмяРасширения_&quot;, 
        однако компонента должна явно указать поддержку версии 2.0 в методе GetInfo.  
        В противном случае допускается создание только одного объекта.</p>
    </td>
  </tr>
</table>
<h3>&nbsp;</h3>
<h3><a name="_Toc502332893">HRESULT RegisterExtensionAs(BSTR 
  *pExtensionName):</a></h3>
<p><b>Параметры:</b></p>
<table>
  <tr> 
    <td>       <i>pExtensionName</i>    </td>
    <td> 
      <p>Наименование 
        расширения встроенного языка 1С:Предприятия.</p>
    </td>
  </tr>
</table>
<p><b>Возвращаемое значение:</b></p>
<p>S_OK</p>
<p><b>Описание:</b></p>
<p>В 
  переменную pExtensionName помещается наименование расширения. Память для строки 
  выделяется объектом компоненты стандартными системными функциями для работы 
  с OLEстроками (например, SysAllocString. 1С:Предприятие освобо ж дает эту память 
  вызовом SysFreeString).</p>
<h2><a name="_Toc502332894">Свойства расширения</a></h2>
<table>
  <tr bgcolor="#FFFFCC"> 
    <td> 
      <p>Первое 
        свойство имеет порядковый номер 0.</p>
    </td>
  </tr>
</table>
<h3>&nbsp;</h3>
<h3><a name="_Toc502332895">HRESULT GetNProps(long *plProps)</a></h3>
<p><b>Параметры:</b></p>
<table>
  <tr> 
    <td> 
      <p>plProps<b></b></p>
    </td>
    <td> 
      <p>Указатель 
        на переменную, содержащую при возврате количество свойств расширения.<b></b></p>
    </td>
  </tr>
</table>
<p><b>Возвращаемое значение:</b></p>
<p>S_OK</p>
<p><b>Описание:</b></p>
<p>Возвращает 
  количество свойств данного расширения, 0 - при отсутствии свойств. Память для 
  переменной plProps выделяется 1С:Предприятием.</p>
<h3><a name="_Toc502332896">HRESULT FindProp(BSTR pszPropName,long*plPropNum)</a></h3>
<p><b>Параметры:</b></p>
<table>
  <tr> 
    <td> 
      <i>pszPropName</i>
    </td>
    <td> 
      <p>Наименование 
        свойства.</p>
    </td>
  </tr>
  <tr> 
    <td>       <i>plPropNum</i>    </td>
    <td> 
      <p>Указатель 
        на переменную, содержащую при возврате порядковый номер свойства.</p>
    </td>
  </tr>
</table>
<p><b>Возвращаемое значение:</b></p>
<p>S_OK 
  - операция завершена успешно</p>
<p>S_FALSE 
  - свойство с именем pszPropName в данном расширении отсутствует</p>
<p><b>Описание:</b></p>
<p>Возвращает 
  порядковый номер свойства с именем pszPropName; -1, если свойство не найдено. 
  Память для переменной plPropNum выделяется 1С:Предприятием.</p>
<h3><a name="_Toc502332897">HRESULT GetPropName(long lPropNum,long 
  lAliasNum,BSTR *pPropName)</a></h3>
<p>Получить 
  имя свойства по порядковому номеру</p>
<p><b>Параметры:</b></p>
<table>
  <tr> 
    <td> 
      <i>lPropNum</i>
    </td>
    <td> 
      <p>Порядковый 
        номер свойства.</p>
    </td>
  </tr>
  <tr> 
    <td>       <i>lAliasNum</i>    </td>
    <td> 
      <p>Язык 
        наименования:</p>
      <p>0 
        - английское наименование;</p>
      <p>1 
        - локальное наименование.</p>
    </td>
  </tr>
  <tr> 
    <td> 
      <i>pPropName</i>
    </td>
    <td> 
      <p>Указатель 
        на строку, содержащую при</p>
      <p>возврате 
        наименование свойства. </p>
    </td>
  </tr>
</table>
<p><b>Возвращаемое значение:</b></p>
<p>S_OK 
  - операция завершена успешно</p>
<p>S_FALSE 
  - свойство с номером lPropNum в данном расширении отсутствует</p>
<p><b>Описание:</b></p>
<p>В 
  переменную pPropName помещается имя свойства с порядковым номером lPropNum ; 
  если свойство с таким номером отсутствует, в pPropName помещается пустая строка. 
  Память для строки выделяется объектом компоненты стандартными системными функциями 
  для работы с OLEстроками (например,</p>
<p>SysAllocString. 
  1С:Предприятие освобо ж дает эту память вызовом SysFreeString ) .</p>
<h3><a name="_Toc502332898">HRESULT GetPropVal(long lPropNum,VARIANT 
  *pvPropVal)</a></h3>
<p>Получить 
  значение свойства по его порядковому номеру.</p>
<p><b>Параметры:</b></p>
<table>
  <tr> 
    <td>       <i>lPropNum</i>    </td>
    <td> 
      <p>Порядковый 
        номер свойства.</p>
    </td>
  </tr>
  <tr> 
    <td> 
      <i>pvPropVal</i>
    </td>
    <td> 
      <p>Указатель 
        на структуру VARIANT, содержащую при возврате значение свойства.</p>
    </td>
  </tr>
</table>
<p><b>Возвращаемое значение:</b></p>
<p>S_OK 
  - операция завершена успешно</p>
<p>S_FALSE 
  - свойство с номером lPropNum в данном расширении отсутствует или недоступно 
  для чтения.</p>
<p><b>Описание:</b></p>
<p>В 
  переменную pvPropVal помещается значение свойства с порядковым номером lPropNum 
  ; если свойство с таким номером отсутствует или недоступно для чтения, должен 
  иметь тип VT_EMPTY.</p>
<h3>&nbsp;</h3>
<h3><a name="_Toc502332899">HRESULT SetPropVal(long lPropNum, 
  VARIANT *pvPropVal)</a></h3>
<p>Присвоить 
  свойству новое значение.</p>
<p><b>Параметры:</b></p>
<table>
  <tr> 
    <td>       <i>lPropNum</i>    </td>
    <td> 
      <p>Порядковый 
        номер свойства.</p>
    </td>
  </tr>
  <tr> 
    <td> 
      <i>pvPropVal</i>
    </td>
    <td> 
      <p>Структура 
        VARIANT, содержащая новое значение свойства.</p>
    </td>
  </tr>
</table>
<p><b>Возвращаемое значение:</b></p>
<p>S_OK 
  - операция завершена успешно</p>
<p>S_FALSE 
  - свойство с номером lPropNum в данном расширении отсутствует или недоступно 
  для записи.</p>
<p><b>Описание:</b></p>
<p>Переменная 
  pvPropVal содержит значение свойства с порядковым номером lPropNum ; если свойство 
  с таким номером отсутствует, недоступно для чтения или тип переданного pvPropVal 
  не приводится к необходимому, метод должен возвратить S_FALSE.</p>
<h3><a name="_Toc502332900">HRESULT IsPropReadable(long lPropNum, 
  BOOL *pboolPropReadable)</a></h3>
<p>Получить 
  флаг доступности свойства для чтения.</p>
<p><b>Параметры:</b></p>
<table>
  <tr> 
    <td>       <i>lPropNum</i>    </td>
    <td> 
      <p>Порядковый 
        номер свойства.</p>
    </td>
  </tr>
  <tr> 
    <td> 
      <i>pboolPropReadable</i>
    </td>
    <td> 
      <p>Указатель 
        на переменную, содержащую при возврате флаг возможности чтения свойства.</p>
    </td>
  </tr>
</table>
<p><b>Возвращаемое значение:</b></p>
<p>S_OK 
  - операция завершена успешно.</p>
<p>S_FALSE 
  - свойство с номером lPropNum в данном расширении отсутствует.</p>
<p><b>Описание:</b></p>
<p>В 
  переменную pboolPropReadable помещается флаг возможности чтения свойства с порядковым 
  номером lPropNum : FALSE(0) - свойство недоступно для чтения, TRUE(1) - свойство 
  допускает чтение. Если свойство с таким номером отсутствует, метод должен возвращать 
  S_FALSE.</p>
<h3><a name="_Toc502332901">HRESULT IsPropWritable(long lPropNum, 
  BOOL *pboolPropWritable)</a></h3>
<p>Получить 
  флаг доступности свойства для записи.</p>
<p><b>Параметры:</b></p>
<table>
  <tr> 
    <td>       <i>lPropNum</i>    </td>
    <td> 
      <p>Порядковый 
        номер свойства.</p>
    </td>
  </tr>
  <tr> 
    <td> 
      <i>pboolPropWritable</i>
    </td>
    <td> 
      <p>Указатель 
        на переменную, содержащую при возврате флаг возможности записи свойства.</p>
    </td>
  </tr>
</table>
<p><b>Возвращаемое значение:</b></p>
<p>S_OK 
  - операция завершена успешно.</p>
<p>S_FALSE - свойство с номером  в данном расширении 
  отсутствует.</p>
<p><b>Описание:</b></p>
<p>В 
  переменную pboolPropWritable помещается флаг возможности записи свойства с порядковым 
  номером lPropNum : FALSE(0) - свойство недоступно для записи, TRUE(1) - свойство 
  допускает запись. Если свойство с таким номером отсутствует, метод должен возвращать 
  S_FALSE.</p>
<h2><a name="_Toc502332902">Методы расширения</a></h2>
<table>
  <tr bgcolor="#FFFFCC"> 
    <td> 
      <p>     Первый метод имеет порядковый номер 
        0. Первый параметр метода имеет порядковый номер 0.</p>
    </td>
  </tr>
</table>
<h3>&nbsp;</h3>
<h3><a name="_Toc502332903">HRESULT GetNMethods(long *plMethods)</a></h3>
<p>Получить 
  количество методов расширения </p>
<p><b>Параметры:</b></p>
<table>
  <tr> 
    <td>       <i>plMethods</i>    </td>
    <td> 
      <p>Указатель 
        на переменную, содержащую при возврате количество методов расширения языка.</p>
    </td>
  </tr>
</table>
<p><b>Возвращаемое значение:</b></p>
<p>S_OK</p>
<p><b>Описание:</b></p>
<p>В 
  переменную plMethods помещается количество методов данного расширения, 0 - при 
  отсутствии методов.</p>
<h3><a name="_Toc502332904">HRESULT FindMethod(BSTR bstrMethodName,long 
  *plMethNum)</a></h3>
<p>Найти 
  порядковый номер метода по его имени.</p>
<p><b>Параметры:</b></p>
<table>
  <tr> 
    <td> 
      <i>bstrMethodName</i>
    </td>
    <td><p>Имя 
        метода</p>
    </td>
  </tr>
  <tr> 
    <td>       <i>plMethNum</i>    </td>
    <td> 
      <p>Указатель 
        на переменную, содержащую при возврате порядковый номер метода с именем 
        methodName.</p>
    </td>
  </tr>
</table>
<p><b>Возвращаемое значение:</b></p>
<p>S_OK</p>
<p><b>Описание:</b></p>
<p>В 
  переменную plMethNum помещается порядковый номер метода с именем bstrMethodName 
  ; -1 - при отсутствии метода.</p>
<h3><a name="_Toc502332905">HRESULT GetMethodName(long lMethodNum, long lAliasNum,BSTR  
  *pbstrMethName)</a>                      </h3>
<p>Получить 
  имя метода по его порядковому номеру.</p>
<p><b>Параметры:</b></p>
<table>
  <tr> 
    <td> 
      <i>lMethodNum</i>
    </td>
    <td> 
      <p>Порядковый 
        номер метода</p>
    </td>
  </tr>
  <tr> 
    <td>       <i>lAliasNum</i>             </td>
    <td> 
      <p>Язык 
        имени метода:</p>
      <p>0 
        - английское наименование;</p>
      <p>1 
        - локальное наименование.</p>
    </td>
  </tr>
  <tr> 
    <td> 
      <i>pbstrMethName</i>
    </td>
    <td> 
      <p>Указатель 
        на строку, содержащую при возврате имя метода</p>
    </td>
  </tr>
</table>
<p><b>Возвращаемое значение:</b></p>
<p>S_OK 
  - операция завершена успешно</p>
<p>S_FALSE - метод с номером  в данном расширении 
  отсутствует</p>
<p><b>Описание:</b></p>
<p>В 
  переменную помещается имя свойства с порядковым номером; если свойство с таким 
  номером отсутствует, в помещается пустая строка. Память для строки выделяется 
  объектом компоненты стандартными системными функциями для работы с OLEстроками 
  (например, SysAllocString. 1С:Предприятие освобо ждает эту память вызовом SysFreeString) 
  .</p>
<h3><a name="_Toc502332906">HRESULT GetNParams(long lMethodNum, 
  long *plMethParams)</a></h3>
<p>Получить 
  количество параметров метода.</p>
<p><b>Параметры:</b></p>
<table>
  <tr> 
    <td>       <i>lMethodNum</i>     </td>
    <td> 
      <p>Порядковый 
        номер метода</p>
    </td>
  </tr>
  <tr> 
    <td> 
      <i>plMethParams</i>
    </td>
    <td> 
      <p>Указатель 
        на переменную, содержащую при возврате количество параметров </p>
      <p>метода</p>
    </td>
  </tr>
</table>
<p><b>Возвращаемое значение:</b></p>
<p>S_OK 
  - операция завершена успешно</p>
<p>S_FALSE - метод с номером  в данном расширении 
  отсутствует</p>
<p><b>Описание:</b></p>
<p>В 
  переменную plMethParams помещается количество параметров метода с порядковым 
  номером lMethodNum ; если свойство с таким номером отсутствует или не имеет 
  параметров, в помещается 0. Память для переменной выделяется 1С:Предприятием 
  .</p>
<h3><a name="_Toc502332907">HRESULT GetParamDefValue(long lMethodNum, 
  long lParamNum,VARIANT *pvParamDefVal)</a></h3>
<p>Получить 
  значение параметра метода по умолчанию.</p>
<p><b>Параметры:</b></p>
<table>
  <tr> 
    <td>       <i>lMethodNum</i>    </td>
    <td> 
      <p>Порядковый 
        номер метода.</p>
    </td>
  </tr>
  <tr> 
    <td> 
      <i>lParamNum</i>
    </td>
    <td> 
      <p>Порядковый 
        номер параметра.</p>
    </td>
  </tr>
  <tr> 
    <td>       <i>pvParamDefVal</i>    </td>
    <td> 
      <p>Указатель 
        на структуру VARIANT, содержащую при возврате значение параметра по умолчанию.</p>
    </td>
  </tr>
</table>
<p><b>Возвращаемое значение:</b></p>
<p>S_OK 
  - операция завершена успешно (вне зависимости от наличия у параметра значения 
  по умолчанию)</p>
<p>S_FALSE 
  - метод или параметр метода отсутствует</p>
<p><b>Описание:</b></p>
<p>В 
  переменную pvParamDefVal помещается значение по умолчанию параметра lParamNum 
  метода с порядковым номером lMethodNum . В pvParamDefVal помещается тип VT_EMPTY, 
  если метод с таким номером отсутствует, не имеет параметра с номером или параметр 
  не имеет значения по умолчанию. Память для переменной выделяется 1С:Предприятием 
  .</p>
<h3><a name="_Toc502332908">HRESULT HasRetVal(long lMethodNum,BOOL 
  *pboolHasRetVal)</a></h3>
<p>Получить 
  флаг наличия возвращаемого значения.</p>
<p><b>Параметры:</b></p>
<table>
  <tr> 
    <td> 
      <i>lMethodNum</i>
    </td>
    <td> 
      <p>Порядковый 
        номер метода.</p>
    </td>
  </tr>
  <tr> 
    <td> 
      <i>pboolHasRetVal</i>
    </td>
    <td> 
      <p>Указатель 
        на переменную, содержащую при возврате флаг наличия возвращаемого значения.</p>
    </td>
  </tr>
</table>
<p><b>Возвращаемое значение:</b></p>
<p>S_OK 
  - операция завершена успешно</p>
<p>S_FALSE 
  - метод отсутствует</p>
<p><b>Описание:</b></p>
<p>В 
  переменную pboolHasRetVal помещается флаг наличия возвращаемого значения у метода 
  с порядковым номером lMethodNum : TRUE для методов с возвращаемым значением 
  и FALSE в противном случае. Память для переменной выделяется 1С:Предприятием 
  .</p>
<h3><a name="_Toc502332909">HRESULT CallAsProc(long lMethodNum, 
  SAFEARRAY **pVars)</a></h3>
<p>Вызов 
  метода без возвращаемого значения (процедуры).</p>
<p><b>Параметры:</b></p>
<table>
  <tr> 
    <td>       <i>lMethodNum</i>    </td>
    <td> 
      <p>Порядковый 
        номер метода.</p>
    </td>
  </tr>
  <tr> 
    <td> 
      <i>pVars</i>
    </td>
    <td> 
      <p>Двойной 
        указатель на массив структур VARIANT, содержащий значения параметров метода. 
        Если метод не имеет параметров, то содержит NULL.</p>
    </td>
  </tr>
</table>
<p><b>Возвращаемое значение:</b></p>
<p>S_OK 
  - соответствующий метод вызван, ошибок не произошло.</p>
<p>E_FAIL 
  - соответствующий метод вызван, произошла ошибка времени исполнения (runtime 
  error). Исполнение модуля прекращается.</p>
<p>S_FALSE 
  - отсутствует метод, соответствующий переданному lMethodNum.</p>
<p><b>Описание:</b></p>
<p>Выполняется 
  метод с порядковым номером lMethodNum . Если метод возвращает E_FAIL, возникает 
  ошибка времени выполнения и выполнение модуля 1С:Предприятия прекращается. Память 
  для массива параметров выделяется 1С:Предприятием.</p>
<h3><a name="_Toc502332910">HRESULT CallAsFunc(long lMethodNum, 
  VARIANT *pRetValue, SAFEARRAY**pVars)</a></h3>
<p>Вызов 
  метода с возвращаемым значением (функции).</p>
<p><b>Параметры:</b></p>
<table>
  <tr> 
    <td>       <i>lMethodNum</i>    </td>
    <td> 
      <p>Порядковый 
        номер метода.</p>
    </td>
  </tr>
  <tr> 
    <td> 
      <i>pRetValue </i>
    </td>
    <td> 
      <p>Указатель 
        на структуру VARIANT, при возврате содержащую возвращаемое значение.</p>
    </td>
  </tr>
  <tr> 
    <td>       <i>pVars</i>    </td>
    <td> 
      <p>Двойной 
        указатель на массив структур VARIANT, содержащий значения параметров метода. 
        Если метод не имеет параметров, то содержит NULL.</p>
    </td>
  </tr>
</table>
<p>      </p>
<p><b>Возвращаемое значение:</b></p>
<p>S_OK 
  - соответствующий метод вызван, ошибок не произошло.</p>
<p>E_FAIL 
  - соответствующий метод вызван, произошла ошибка времени исполнения (runtime 
  error). Исполнение модуля прекращается.</p>
<p>S_FALSE 
  - отсутствует метод, соответствующий переданному lMethodNum.</p>
<p><b>Описание:</b></p>
<p>Выполняется 
  метод с порядковым номером lMethodNum . Если метод возвращает E_FAIL, возникает 
  ошибка времени выполнения и выполнение модуля 1С:Предприятия прекращается. Память 
  для массива параметров и возвращаемого значения выделяется 1С:Предприятием.</p>
<h1><a name="_Toc502332911">Использование типа OLE VARIANT при обмене данными</a></h1>
<h2><a name="_Toc502332912">Вызов функции компоненты</a></h2>
<p>неопределенное 
  значение соответствует VT_EMPTY;</p>
<p>целочисленное 
  значение соответствует VT_I4 и помещается в lVal;</p>
<p>дробное 
  значение соответствует VT_R8 и помещается в dblVal;</p>
<table>
  <tr bgcolor="#FFFFCC"> 
    <td> 
      <p>Следует 
        учесть, что внутреннее представление может иметь точность,превосходящую 
        точность типа double (около 15 цифр после запятой), поэтому при конвертации 
        может происходить потеря точности.</p>
    </td>
  </tr>
</table>
<p>значение 
  даты соответствует VT_DATE и помещается в date;</p>
<p>строковое 
  значение соответствует VT_BSTR и помещается в bstrVal;</p>
<p>значения 
  перечисление, субконто, документ, алгоритм, календарь, счет соответствуют VT_DISPATCH 
  и помещаются в pdispVal. Указатель на Idispatch освобождается непосредственно 
  после возврата из функции компоненты вызовом Release. Для указателя на IDispatch 
  выполняется AddRe f . При использовании объектов 1С:Предприятия в компоненте 
  необходимо определить DISPIDы методов объекта (вызвав GetIDsOfNames) и затем 
  вызвать Invoke;</p>
<p>значение 
  OLE объекта соответствует VT_DISPATCH и помещается в pdispVal. Для указателя 
  на IDispatch выполняется AddRef.</p>
<p>При 
  конвертации OLE объекта в IDispatch проверяются ситуации взаимного вызова &quot;1С:Предприятие-&gt;Компонента-&gt;1С:Предприятие&quot; 
  и &quot;Компонента-&gt;1С:Предприятие-&gt;Компонента&quot; и все необходимые 
  операции проводятся корректно.</p>
<h2><a name="_Toc502332913">Возвращение значений из компоненты</a></h2>
<p>VT_EMPTY 
  соответствует неопределенному значению. При передаче в качестве параметра метода 
  подставляется значение параметра по умолчанию;</p>
<p>значения 
  типа VT_I2, VT_I4, VT_BOOL, VT_ERROR, VT_UI1 соответствуют целочисленному значению 
  и находятся в lVa l;</p>
<p>значения 
  типа VT_R4, VT_R8, VT_CY соответствуют дробному значению и находятся в dblVal;</p>
<p>значение 
  типа VT_DATE соответствует значению даты и находится в date;</p>
<p>значение 
  типа VT_BSTR соответствует строковому значению и находится в bstrVal;</p>
<p>значение 
  типа VT_DISPATCH соответствует значению OLE объекта и находится в pdispVal.</p>
<p>Типы 
  VT_DECIMAL, VT_VARIANT, VT_UNKNOWN и VT_ARRAY не поддерживаются.</p>
<p>При 
  конвертации IDispatch в OLE объект проверяются ситуации взаимного вызова &quot;1С:Предприятие-&gt;Компонента-&gt;1С:Предприятие&quot; 
  и &quot;Компонента-&gt;1С:Предприятие-&gt;Компонента&quot; и все необходимые 
  операции проводятся корректно.</p>
<h2><a name="_Toc502332914">Вызов метода объекта 1С:Предприятия из компоненты</a></h2>
<p>Для 
  вызова метода объекта необходимо вызвать метод Invoke полученного ранее интерфейса 
  IDispatch, передав ему все необходимые параметры, в том числе номер (DISPID) 
  вызываемого метода объекта. Этот номер можно получить из метода GetIDsOfNames 
  интерфейса IDispatch, передав ему название метода объекта.</p>
<p>Соответствие 
  между параметрами метода объекта и массивом структур VARIANT прямое: первому 
  параметру соответствует структура с индексом 0, второму параметру - структура 
  с индексом 1 и т.д. При передаче параметров метода объекта следует учесть, что 
  необходимо передавать значения всех параметров, включая значения параметров, 
  подставляемые по умолчанию. Для подстановки значений по умолчанию достаточно 
  присвоить тип VT_EMPTY соответствующей структуре VARIANT.</p>
<h1><a name="_Toc502332915">OLE интерфейсы 1C:Предприятия</a></h1>
<p>Все 
  нижеприведенные интерфейсы могут быть получены вызовом QueryInterface переданного 
  при инициализации объекта указателя на IDispatch. Их идентификаторы (IID) Вы 
  можете найти в шаблонах, включенных в данную поставку.</p>
<h2><a name="_Toc502332916">Сохранение параметров объекта компоненты</a></h2>
<p>Для сохранения параметров объект внешней компоненты 
  может использовать механизмы сохранения 1С:Предприятия через интерфейс IPropertyProfile.  
</p>
<p>Этот 
  интерфейс унаследован от интерфейса IPropertyBag , стандартного для OLE, и отличается 
  единственным методом:</p>
<h3><a name="_Toc502332917">HRESULT RegisterProfileAs(BSTR bstrProfileName)</a></h3>
<p>Регистрация 
  списка параметров компоненты.</p>
<p><b>Параметры:</b></p>
<table>
  <tr> 
    <td> 
      <i>bstrProfileName</i>
    </td>
    <td> 
      <p>Наименование 
        списка параметров компоненты.</p>
    </td>
  </tr>
</table>
<p><b>Возвращаемое значение:</b></p>
<p>S_OK 
  - регистрация прошла успешно.</p>
<p>E_FAIL 
  - при регистрации произошла ошибка. Информация об ошибке выводится в окно сообщений.</p>
<p><b>Описание:</b></p>
<p>Регистрирует 
  список параметров компоненты с именем bstrProfileName.</p>
<p>При 
  загрузке и сохранении параметры могут быть структурированы в виде дерева - для 
  этого при передаче в методах Read и Write имя параметра необходимо записывать 
  в виде &quot;Узел1\Узел2\...\УзелN\ИмяПараметра:ЗначениеПараметраПоУмолчанию&quot;. 
  При работе с 1С:Предприятием 7.5 параметры сохраняются в регистрационной базе 
  данных системы (Registry) под ключом HKEY_CURRENT_USER\Software\1C\1Cv7\7.5\Options, 
  при работе с 1С:Предприятием 7.7 - под ключом</p>
<p>HKEY_CURRENT_USER\Software\1C\1Cv7\7.7\Options . </p>
<h2><a name="_Toc502332918">Информационные сообщения о работе объекта</a></h2>
<p>Для 
  сообщения пользователю информации о своей работе объект может использовать интерфейс 
  IErrorLog, стандартный для OLE (описание метода AddError интерфейса IErrorLog 
  приводится здесь исключительно для удобства работы). Возникающие сообщения обработываются 
  как в течение работы</p>
<p>программы 
  (при асинхронном помещении их в очередь), так и в следующих случаях: при возврате 
  из метода инициализации Init ( см. стр. * ) и при возврате из метода расширения 
  . Все сообщения помещаются в очередь и обрабатываются по порядку появления. 
  Количество запоминаемых сообщений не ограничено.</p>
<h3><a name="_Toc502332919">HRESULT AddError(BSTR pszPropName, 
  LPEXCEPINFO pExcepInfo)</a></h3>
<p>Добавить 
  сообщение.</p>
<p><b>Параметры:</b></p>
<table>
  <tr> 
    <td>       <i>pszPropName</i>    </td>
    <td> 
      <p>В настоящей реализации параметр  pszPropName 
        игнорируется.</p>
    </td>
  </tr>
  <tr> 
    <td> 
      <i>pExcepInfo</i>
    </td>
    <td> 
      <p>Указатель 
        на структуру EXCEPINFO .</p>
    </td>
  </tr>
</table>
<p><b>Возвращаемое значение:</b></p>
<p>S_OK 
  - сообщение добавлено успешно.</p>
<p>E_OUTOFMEMORY 
  - Недостаточно памяти.</p>
<p>Возможны 
  другие коды возврата, сигнализирующие об ошибке.</p>
<p><b>Описание:</b></p>
<p>Добавляет 
  информационное сообщение при работе методов расширения языка.</p>
<p>Возможные 
  коды сообщений:</p>
<p>#define ADDIN_E_NONE 1000</p>
<p>#define ADDIN_E_ORDINARY 1001</p>
<p>#define ADDIN_E_ATTENTION 1002</p>
<p>#define ADDIN_E_IMPORTANT 1003</p>
<p>#define ADDIN_E_VERY_IMPORTANT 1004</p>
<p>#define ADDIN_E_INFO 1005</p>
<p>#define ADDIN_E_FAIL 1006</p>
<p>#define ADDIN_E_MSGBOX_ATTENTION 1007</p>
<p>#define ADDIN_E_MSGBOX_INFO 1008</p>
<p>#define ADDIN_E_MSGBOX_FAIL 1009</p>
<p>Код 
  сообщения помещается в wCode структуры EXEPINFO. Коды ошибок 1000 - 2000 зарезервированы.</p>
<p>При 
  обработке сообщения выводится окно предупреждения (Message Box) для кодов ADDIN_E_MSGBOX_ATTENTION, 
  ADDIN_E_MSGBOX_INFO и ADDIN_E_MSGBOX_FAIL или строка с сообщением в окне 
  сообщений для остальных кодов. В общем случае строка имеет вид:</p>
<p>&lt; 
  Иконка &gt; &lt; ИсточникСообщения &gt; : &lt; ОписаниеСообщения &gt; ( Код 
  сообщения = &lt;КодСообщения &gt;),</p>
<p>где 
  &lt; Иконка &gt;:</p>
<p>ADDIN_E_NONE 
  - иконка отсутствует</p>
<p>ADDIN_E_ORDINARY - <img src="img/image305.bmp"></p>
<p>ADDIN_E_ATTENTION - <img src="img/image306.bmp"></p>
<p>ADDIN_E_IMPORTANT - <img src="img/image307.bmp"></p>
<p>ADDIN_E_VERY_IMPORTANT - <img src="img/image308.bmp"></p>
<p>ADDIN_E_INFO - <img src="img/image309.bmp"></p>
<p>ADDIN_E_FAIL - <img src="img/image310.bmp"></p>
<p>Иконка 
  отсутствует, если используется код cообщения, не совпадающий с вышеперечисленными.</p>
<p>&lt; 
  ИсточникОшибки &gt; : поле bstrSource в структуре EX CEPINFO</p>
<p>&lt; 
  ОписаниеОшибки &gt; : поле bstrDescription в структуре EXCEPINFO</p>
<p>&lt; 
  КодОшибки &gt; : числовой код c ообщения в десятичном виде. Код c ообщения не 
  выводится, если используется один из вышеперечисленных кодов.</p>
<p>Для 
  кодов ADDIN_E_MSGBOX_ATTENTION, ADDIN_E_MSGBOX_INFO и ADDIN_E_MSGBOX_FAIL выводится 
  окно сообщения с кнопкой OK и иконками MB_ICONEXCLAMATION, MB_ICONINFORMATION и MB_ICONERROR соответственно.</p>
<p>Сообщение 
  имеет вид:</p>
<p>&lt;Источник 
  Сообщения &gt;:&lt;Описание Сообщения &gt;(Код c ообщения = &lt;Код Сообщения 
  &gt;),</p>
<p>где 
  &lt;ИсточникСообщения &gt;, &lt; ОписаниеСообщения &gt; и &lt; КодСообщения&gt; 
  см. выше.</p>
<h2><a name="_Toc502332920">Внешние события</a></h2>
<p>При 
  возникновении асинхронного события (например, считывания штрих-кода) объект 
  может использовать интерфейс IAsyncEvent для создания внешнего события в 1С:Предприятии. 
  Интерфейс IAsyncEvent унаследован от IUnknown. </p>
<p>Все 
  события помещаются в очередь и обрабатываются по порядку появления. Количество 
  запоминаемых событий ограничено длиной очереди. При инициализации длина очереди 
  устанавливается равной 1 и может быть изменена вызовами GetEventBufferDepth и SetEventBufferDepth .. Для каждого объекта</p>
<p>внешней 
  компоненты поддерживается своя очередь событий. Обработка внешнего события производится 
  процедурой ОбработкаВнешнегоСобытия.</p>
<h3><a name="_Toc502332921">HRESULT SetEventBufferDepth(long 
  lDepth)</a></h3>
<p>Установить 
  размер очереди событий.</p>
<p><b>Параметры:</b></p>
<table>
  <tr> 
    <td>       <i>lDepth</i>    </td>
    <td> 
      <p>Длина 
        очереди сообщений.</p>
    </td>
  </tr>
</table>
<p><b>Возвращаемое значение:</b></p>
<p>S_OK 
  - размер очереди установлен успешно</p>
<p>E_FAIL 
  - при установке размера очереди произошла ошибка</p>
<p>Возможны 
  другие коды возврата, сигнализирующие об ошибке.</p>
<p><b>Описание:</b></p>
<p>Устанавливает 
  размер очереди событий для данного объекта. Если текущее</p>
<p>количество 
  событий в очереди больше устанавливаемой длины, последние</p>
<p>события 
  обрезаются.</p>
<h3><a name="_Toc502332922">HRESULT </a>GetEventBufferDepth(long *plDepth)</h3>
<p>Получить 
  размер очереди событий.</p>
<p><b>Параметры:</b></p>
<table>
  <tr> 
    <td> 
      <i>plDepth</i>
    </td>
    <td> 
      <p>Указатель 
        на переменную, содержащую при возврате длину очереди сообщений.</p>
    </td>
  </tr>
</table>
<p><b>Возвращаемое значение:</b></p>
<p>S_OK 
  - размер очереди возвращен успешно</p>
<p>E_FAIL 
  - при получении размера очереди произошла ошибка</p>
<p>Возможны 
  другие коды возврата, сигнализирующие об ошибке.</p>
<p><b>Описание:</b></p>
<p>В 
  переменную plDepth помещается размер очереди событий для данного объекта.</p>
<h3><a name="_Toc502332923">HRESULT ExternalEvent(BSTR bstrWho, 
  BSTR bstrWhat, BSTR bstrData)</a></h3>
<p>Поместить 
  событие в очередь.</p>
<p><b>Параметры:</b></p>
<table>
  <tr> 
    <td>       <i>BstrWho</i>    </td>
    <td> 
      <p>строка 
        с наименованием источника сообщения.</p>
    </td>
  </tr>
  <tr> 
    <td> 
      <i>BstrWhat</i>
    </td>
    <td> 
      <p>строка 
        с наименованием сообщения.</p>
    </td>
  </tr>
  <tr> 
    <td>       <i>BstrData</i>    </td>
    <td> 
      <p>строка 
        c параметрами сообщения.</p>
    </td>
  </tr>
</table>
<p><b>Возвращаемое значение:</b></p>
<p>S_OK 
  - событие помещено в очередь</p>
<p>E_FAIL 
  - очередь переполнена или неизвестная ошибка</p>
<p>E_OUTOFMEMORY 
  - отсутствие памяти</p>
<p>Возможны 
  другие коды возврата, сигнализирующие об ошибке.</p>
<p><b>Описание:</b></p>
<p>Помещает 
  событие в очередь, записывая источник события, наименование и параметры события. 
  При обработке события эти данные передаются процедуре ОбработкаВнешнегоСобытия. 
  При вызове метода ExternalEvent дальнейшая обработка события происходит следующим 
  образом: событие записывается в очередь событий (если очередь полностью занята, 
  событие теряется), затем при отсутствии системных событий из очереди берется 
  первое событие (если очередь не пуста) и вызывается соответствующая функция 
  ОбработкаВнешнегоСобытия. Этот процесс повторяется для всех объектов внешних 
  компонент. Таким образом, обработка внешних событий синхронизируется с обработкой 
  системных событий.</p>
<h3><a name="_Toc502332924">HRESULT CleanBuffer()</a></h3>
<p>Очищает 
  очередь событий.</p>
<p><b>Параметры:</b></p>
<p>Отсутствуют</p>
<p><b>Возвращаемое значение:</b></p>
<p>S_OK 
  - очередь успешно очищена</p>
<p>E_FAIL 
  - при очищении очереди произошла ошибка</p>
<p>Возможны 
  другие коды возврата, сигнализирующие об ошибке.</p>
<p><b>Описание:</b></p>
<p>Очищает 
  очередь событий, удаляя все присутствующие в очереди события.</p>
<h2><a name="_Toc502332925">Работа с строкой состояния</a></h2>
<p>Для информирования пользователя о своем состоянии 
  объект компоненты может использовать интерфейс IStatusLine. При вызове метода 
  SetStatusLine переданный текст немедленно отображается в строке состояния. При 
  вызове метода ResetStatusLine в строке состояния отображается  стандартный текст.</p>
<h3><a name="_Toc502332926">HRESULT SetStatusLine(BSTR bstrStatusText)</a></h3>
<p>Установить 
  текст строки состояния.</p>
<p><b>Параметры:</b></p>
<table>
  <tr> 
    <td> 
      <i>bstrStatusText</i>
    </td>
    <td> 
      <p>Текст 
        строки состояния.</p>
    </td>
  </tr>
</table>
<p><b>Возвращаемое значение:</b></p>
<p>S_OK 
  - текст отображен в строке состояния</p>
<p>E_FAIL 
  - неизвестная ошибка</p>
<p>Возможны 
  другие коды возврата, сигнализирующие об ошибке.</p>
<p><b>Описание:</b></p>
<p>Устанавливает 
  текст строки состояния.</p>
<h3><a name="_Toc502332927">HRESULT ResetStatusLine()</a></h3>
<p>Установить 
  текст строки состояния.</p>
<p><b>Параметры:</b></p>
<p>отсутствует</p>
<p><b>Возвращаемое значение:</b></p>
<p>S_OK 
  -строка состояния успешно переинициализирована</p>
<p>E_FAIL 
  - неизвестная ошибка</p>
<p>Возможны 
  другие коды возврата, сигнализирующие об ошибке.</p>
<p><b>Описание:</b></p>
<p>Инициализирует 
  строку состояния.</p>
<h1><a name="_Toc502332928">Создание окон в среде 1С:Предприятия</a></h1>
<p>Версия технологии: 2.0 и выше</p>
<p>Внешние 
  компоненты могут создавать свои окна для отображения различной информации, используя 
  интерфейс IExtWndsSupport. Компонента может создавать три типа окон: модальные 
  диалоги, немодальные диалоги и формы.</p>
<h3><a name="_Toc502332929">Модальные диалоги</a></h3>
<p>Модальные 
  диалоги создаются самой компонентой, но при их создании необходимо в качестве 
  родительского окна указать окно, возвращаемое методом GetAppMainFrame для того, 
  чтобы диалог не воспринимался операционной системой как отдельная задача с кнопкой 
  на полосе задач. Работа системы 1С:Предприятие приостанавливается до завершения 
  работы с диалогом.</p>
<h3><a name="_Toc502332930">Немодальные диалоги</a></h3>
<p>Немодальные 
  диалоги также создаются самой компонентой, но при их создании необходимо в качестве 
  родительского окна указать окно, возвращаемое методом GetAppMDIFrame для того, 
  чтобы диалог не воспринимался операционной системой как отдельная задача с кнопкой 
  на полосе задач. Диалог не останавливает работу 1С:Предприятия и по сути аналогичен 
  формам 1С:Предприятия. Однако следует учесть, что созданный диалог не входит 
  в список открытых окон и не появляется на панели окон, поэтому использование 
  таких диалогов не рекомендуется (вместо них можно использовать формы самого 
  1С:Предприятия или формы, созданные внешней компонентой).</p>
<h3><a name="_Toc502332931">Формы</a></h3>
<p>Формы создаются функцией CreateAddInWindow и аналогичны 
  формам, созданным в 1С:Предприятии. При создании  окна внешняя компонента передает 
  в качестве одного из параметров ProgID OLE-объекта, поддерживающего некоторый 
  предопределенный набор интерфейсов, описанный в технологии Активных документов 
  (Active Documents, см. документацию по OLE). Этот объект отображается в окне 
  1С:Предприятия и может управляться внешней компонентой через возвращаемый интерфейс 
  IDispatch.</p>
<table>
  <tr bgcolor="#FFFFCC"> 
    <td> 
      <p>От объекта, отображаемого в окне 1С:Предприятия, не требуется следование 
        технологии внешних компонент, необходимо лишь следование стандарту на 
        Активные документы.</p>
    </td>
  </tr>
</table>
<h3>&nbsp;</h3>
<h3><a name="_Toc502332932">HRESULT GetAppMainFrame(HWND *pHWnd)</a></h3>
<p>Получить 
  основное окно 1С:Предприятия.</p>
<p><b>Параметры:</b></p>
<table>
  <tr> 
    <td>       <i>pHWnd</i>    </td>
    <td> 
      <p>указатель 
        на дескриптор окна</p>
    </td>
  </tr>
</table>
<p><b>Возвращаемое значение:</b></p>
<p>S_OK</p>
<p><b>Описание:</b></p>
<p>Возвращает 
  дескриптор основного окна 1С:Предприятия.</p>
<h3><a name="_Toc502332933">HRESULT GetAppMDIFrame(HWND *pHWnd)</a></h3>
<p>Получить 
  окно 1С:Предприятия, являющееся родительским для форм 1С:Предприятия.</p>
<p><b>Параметры:</b></p>
<table>
  <tr> 
    <td> 
      <i>pHWnd</i>
    </td>
    <td> 
      <p>указатель 
        на дескриптор окна</p>
    </td>
  </tr>
</table>
<p><b>Возвращаемое значение:</b></p>
<p>S_OK</p>
<p><b>Описание:</b></p>
<p>Возвращает 
  дескриптор окна 1С:Предприятия, содержащего формы 1С:Предприятия.</p>
<h3><a name="_Toc502332934">HRESULT CreateAddInWindow(BSTR bstrProgID, BSTR bstrTitle, 
  long lStyles,long lExStyles, RECT *rctSize, long lFlags, HWND *pHwnd, IDispatch   
  **pDisp)</a></h3>
<p>Создать 
  окно 1С:Предприятия.</p>
<p><b>Параметры:</b></p>
<table>
  <tr> 
    <td>       <i>bstrProgID</i>    </td>
    <td> 
      <p>ProgID 
        OLE-объекта, являющегося Активным документом</p>
    </td>
  </tr>
  <tr> 
    <td> 
      <i>bstrWindowName</i>
    </td>
    <td> 
      <p>Заголовок 
        окна</p>
    </td>
  </tr>
  <tr> 
    <td>       <i>lStyles</i>    </td>
    <td> 
      <p>Стили 
        окна</p>
    </td>
  </tr>
  <tr> 
    <td> 
      <i>lExStyles</i>
    </td>
    <td> 
      <p>Дополнительные 
        стили окна</p>
    </td>
  </tr>
  <tr> 
    <td>       <i>rctSize</i>    </td>
    <td> 
      <p>Размеры 
        окна</p>
    </td>
  </tr>
  <tr> 
    <td> 
      <i>lFlags</i>
    </td>
    <td> 
      <p>Дополнительные 
        флаги</p>
    </td>
  </tr>
  <tr> 
    <td>       <i>pHwnd</i>    </td>
    <td> 
      <p>Указатель 
        на дескриптор окна</p>
    </td>
  </tr>
  <tr> 
    <td> 
      <i>pDisp</i>
    </td>
    <td> 
      <p>Указатель 
        на интерфейс Idispatch созданного Активного документа.</p>
    </td>
  </tr>
</table>
<p><b>Возвращаемое значение:</b></p>
<p>S 
  _OK -окно успешно создано</p>
<p>E_FAIL 
  -ошибка при создании окна</p>
<p>Возможны 
  другие коды возврата, сигнализирующие об ошибке.</p>
<p><b>Описание:</b></p>
<p>Создает 
  окно 1С:Предприятия с объектом bstrProgID . Окно имеет заголовок bstrWindowName 
  и стили lStyles и lExStyles . При передаче 0 в качестве стилей используются 
  стили окна по умолчанию. Размеры окна указываются следующим образом: верхний 
  левый угол rctSize обозначает верхний левый</p>
<p>угол создаваемого окна в координатах экрана, ширина 
  и высота rctSize соответствуют ширине и высотеклиентской части создаваемого 
  окна (т.е. той части, где отображается Активный документ). Параметр lFlags  
  в настоящее время не используется и должен быть равен 0. В параметрах  pHwnd 
  и pDisp возвращаются соответственно дескриптор созданного окна и интерфейс IDispatch 
  объекта bstrProgID. Для указателя pDisp необходимо вызвать Release.</p>
<h1><a name="_Toc502332935">Доступ к 1С:Предприятию через механизм OLE Automation</a></h1>
<p>Версия 
  технологии: 2.0 и выше</p>
<p>Переданный 
  в методе Init указатель на IDispatch позволяет получить доступ</p>
<p>к 
  1С:Предприятию через механизм OLE Automation. Из полученного указателя</p>
<p>можно 
  получить свойство AppDispatch, доступное только для чтения. Это</p>
<p>свойство 
  содержит указатель на IDispatch 1C:Предприятия (не путайте с</p>
<p>переданным 
  в Init). При получении указателя его необходимо освободить</p>
<p>вызовом 
  Release. Visual Basic и Borland Delphi позволяют делать это</p>
<p>автоматически.</p>
<table>
  <tr bgcolor="#FFFFCC"> 
    <td> 
      <p>Свойство 
        AppDispatch становится доступно только после полной инициализации всей 
        системы 1С:Предприятие, поэтому в момент загрузки внешней компоненты и 
        вызова метода Init это свойство недоступно.</p>
    </td>
  </tr>
</table>
<h1><a name="_Toc502332936">Доступ к методам интерфейсов 1С:Предприятия через 
  OLE Automation</a></h1>
<p>Visual Basic имеет ограниченные возможности по 
  работе с различными интерфейсами. Наиболее &quot;естественным&quot; механизмом 
  для Visual Basic является работа с OLE Automation, для этого в VB используется 
  тип Object, который представляет собой указатель на IDispatch. Поэтому  1С:Предприятие 
  предоставляет возможность использовать механизм OLE Automation, передавая указатель 
  на IDispatch в методе Init и обеспечивая вызовы методов вышеперечисленных интерфейсов 
  через OLE Automation. </p>
<p><b>Методы, 
  доступные через OLE Automation:</b></p>
<p>RegisterProfileAs 
  (&lt;ИмяСпискаПараметров&gt;)</p>
<p>Read 
  (&lt;ИмяПеременной&gt;,&lt;СсылкаНаVARIANT&gt;)</p>
<p>Write 
  (&lt;ИмяПеременной&gt;,&lt;СсылкаНаVARIANT&gt;)</p>
<p>SetEventBufferDepth 
  (&lt;ДлинаОчередиСобытий&gt;)</p>
<p>GetEventBufferDepth 
  (&lt;СсылкаНаДлинуОчереди&gt;)</p>
<p>ClearEventBuffer 
  ()</p>
<p>ExternalEvent(&lt;СтрокаИсточникСобытия&gt;,&lt;СтрокаНаименованиеСобытия&gt;,&lt;СтрокаПараметрыСобытия&gt;)</p>
<p>AddError(&lt;КодСообщения&gt;,&lt;СтрокаИсточникСообщения&gt;,&lt;СтрокаОписаниеСообщения&gt;,&lt;КодОшибки&gt;)</p>
<p>SetStatusLine (&lt;СтрокаСостояния&gt;)</p>
<p>ResetStatusLine ()</p>
<p><b>Версия 
  2.0 и выше:</b></p>
<p>свойство 
  AppDispatch</p>
<p>GetAppMainFrame 
  (&lt;Указатель на дескриптор окна&gt;)</p>
<p>GetAppMDIFrame 
  (&lt;Указатель на дескриптор окна&gt;)</p>
<p>CreateAddInWindow (&lt;ProgID&gt;, &lt;Заголовок 
  окна&gt;, &lt;Стили окна&gt;, &lt;Доп. стили окна&gt;, &lt;Координата верхнего 
  левого угла окна по горизонтали&gt;, &lt;Координата верхнего левого угла окна 
  по вертикали&gt;, &lt;Ширина окна&gt;, &lt;Высота окна&gt;, &lt;Доп. флаги (всегда 
  0)&gt;, &lt;Указатель на дескриптор окна&gt;,  &lt;Указатель на интерфейс IDispatch)<!-- SpyLOG --> </p>
</body>
</html>
