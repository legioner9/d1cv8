<html>
<head>
<title>1С-Предприятие. Документация | Технология создания внешних компонент. Часть 
3 - Введение в OLE</title>
<meta http-equiv="Content-Type" content="text/html; charset=windows-1251">
<link rel="stylesheet" type="text/css" href="../../../1c.css">
</head>

<body bgcolor="#FFFFFF">
<h2 align="left" class="highlink"><font size="4">Часть 3. Введение в OLE</font></h2>
<hr>
<ul>
  <li><a href="#003001">Интерфейсы в OLE</a></li>
  <li><a href="#003002">Объекты OLE</a></li>
  <li><a href="#003003"> OLE Automation</a></li>
  <li><a href="#003004"> Active Documents</a></li>
  <li><a href="#003005">Литература</a></li>
</ul>
<p>Эта часть описывает основы OLE и не является полным руководством по OLE (ActiveX) 
  и OLE технологиям. Для более глубокого изучения OLE Вам следует обратиться к 
  руководствам, приведенным в списке литературы. </p>
<h3 class=MsoPlainText><a name="003001"></a>Интерфейсы 
  в OLE</h3>
<p>Центральным понятием в OLE является 
  понятие &quot;интерфейс&quot;. Под интерфейсом понимается 
  некоторое множество функций, организованное по определенному стандарту. 
  Этот стандарт называется COM (Common Object Model) и вследствие этого 
  OLE-объекты иногда называют COM-объектами. Стандарт COM определяет таблицу 
  функций интерфейса, называемую vtable. Эта таблица имеет фиксированную 
  структуру и включает в себя указатели на функции данного интерфейса, 
  что позволяет вызывать функции интерфейса по ссылке на интерфейс.</p>
<p>В стандарте COM определен один 
  интерфейс, называемый <b>IUnknown</b>, от которого наследуются все остальные 
  OLE интерфейсы (т.е. все интерфейсы содержат функции 
  <i>IUnknown</i>). В<i> IUnknown</i> входят три функции:</p>
<p><b><i>AddRef</i></b> 
  - увеличивает счетчик ссылок объекта на 1 (см.стр. 
  * );</p>
<p><b><i>Release</i></b> 
  - уменьшает счетчик ссылок объекта на 1 (см.стр. * );</p>
<p><b><i>QueryInterface</i></b> 
  - запрашивает интерфейс у OLE объекта.</p>
<p>В OLE используется большое количество 
  различных интерфейсов, построенных по единому стандарту COM, с различными наборами 
  функций. Каждому интерфейсу присвоен уникальный 
  номер: <b>GUID</b>.</p>
<table width="100%" border="0" bgcolor="#FFFFCC">
  <tr> 
    <td> 
      <p><i><b>GUID</b></i> (Globally Unique Id entifier) - 16-байтное число, 
        создаваемое по специальному алгоритму. Этот алгоритм гарантирует уникальность 
        числа &quot;в пространстве Вселенной за время ее существования&quot;. 
        Обычно это число     записывается в виде   {89ABCDEF-1234- 5678-9ABC-DEF012345678}. </p>
    </td>
  </tr>
</table>
<p> Уникальный номер 
  интерфейса называют <b>IID</b> (Interface Id entifier) для отличения 
  от других идентификаторов.</p>
<h3 class=MsoPlainText><a name="003002"></a>Объекты 
  OLE</h3>
<p>Каждый OLE-объект реализует один 
  или несколько интерфейсов для выполнения различных 
  задач и обязательный интерфейс IUnknown. Для создания объекта и получения 
  указателя на один из интерфейсов используются функции Win32: <i>CoCreateInstanceEx, 
  CoCreateInstanceFromFile, CoGetClassObject </i>и т.д. </p>
<p>Одним из параметров функций является 
  <b>CLSID</b> (Class Id entifier) - это GUID, используемый 
  при создании объекта. При создании объекта система использует информацию, 
  хранящуюся в регистрационной базе данных системы (Registry).</p>
<p><img src="img/tsvk003001.jpg" width="539" height="294"></p>
<p>Эта информация организована следующим 
  образом:</p>
<ul>
  <li>под ключом <i>HKEY_CLASSES_ROOT </i>лежит ключ, 
    описывающий <b>ProgID </b>(<i>Programmatic </i><i>Id 
    entifier</i>) объекта. ProgID - это текстовая 
    строка, например: <i>Excel.Application</i> 
    . Под ключом ProgID находится ключ CLSID, значением которого является GUID 
    объекта. Таким образом, ProgID - это строка, представляющая удобную для восприятия 
    ссылку на CLSID. Преобразование ProgID в 
    CLSID выполняется Win32 функцией <b>CLSIDFromProgID</b>;</li>
  <li>под ключом <i>HKEY_CLASSES_ROOT\CLSID</i> находится 
    ключ с именем <b>CLSID</b> для объекта. Под 
    этим ключом находятся ключи, описывающие создание объекта: InProcServer32 
    - объект создается из DLL, LocalServer32 - объект создается из 
    приложения, ProgIDобратная ссылка на ProgID и т.д. </li>
</ul>
<p>Другим параметром функций при 
  создании объекта передается  <b>IID</b> 
  - идентификатор необходимого интерфейса. Функции, создающие объект, возвращают 
  указатель на запрошенный интерфейс. Указатель на этот интерфейс может 
  быть использован для получения другого интерфейса вызовом <i>QueryInterface</i>.</p>
<p>Каждый объект поддерживает счетчик 
  ссылок других объектов на себя. Этот счетчик 
  изменяется вызовами <i>AddRef</i> и <i>Release </i>интерфейсов объекта. Если 
  после очередного вызова Release счетчик ссылок 
  достигает нуля, это означает, что ссылки на 
  данный объект отсутствуют и он уничтожается. QueryInterface 
  увеличивает счетчик ссылок автоматически .</p>
<h3 class=MsoPlainText><a name="003003"></a>OLE Automation</h3>
<p>Технология OLE Automation основывается 
  на одном из наиболее известных и часто используемых 
  в OLE интерфейсов - интерфейсе <b>IDispatch</b> . Этот интерфейс 
  позволяет читать и писать свойства OLE Automation объекта и вызывать 
  его функции с произвольным списком параметров. OLE Automation объектом 
  называется любой OLE объект, реализующий IDispatch. Для вызова функции 
  объекта необходимо определить ее номер, затем вызывать метод Invoke 
  интерфейса IDispatch и ей в качестве параметров передать номер вызываемой 
  функции и массив ее параметров. Следует отличать функции OLE</p>
<p>Automation объекта от функций 
  интерфейсов (в частности, IDispatch) -интерфейс 
  имеет жесткий неизменяемый список функций, а OLE Automation объект 
  - произвольных список свойств и функций. Наиболее широко этот интерфейс 
  используется в языке Visual Basic, где определен тип Object - в действительности 
  это указатель на IDispatch.</p>
<p>В<b> IDispatch </b>входят следующие 
  функции:</p>
<p><i><b>GetTypeInfo, GetTypeInfoCount</b></i> 
  - функции для работы с информацией о типах (за 
  дополнительной информацией об этих функциях и работе с типами обращайтесь 
  к рекомендованной литературе);</p>
<p><i><b>GetIDsOfNames</b></i> 
  - позволяет получить номер функции объекта по ее имени;</p>
<p><i><b>Invoke</b></i> 
  - вызов необходимой функции по номеру.</p>
<p>При передаче параметров функции 
  используется структура <b>VARIANT</b>. Эта структура 
  представляет собой объединение различных типов данных и может содержать 
  практически любое значение, используемое на практике.</p>
<h3 class=MsoPlainText><a name="003004"></a>Active Documents</h3>
<p>Этот стандарт позволяет разрабатывать 
  приложения, предназначенные для работы с документами разных видов. Активные 
  документы составляют  с главным окном приложения общее 
  меню и систему панелей инструментов, поэтому 
  их можно интегрировать в общем окне. Примером приложения, использующего 
  Активные документы, является Microsoft Binder из состава Microsoft 
  Office. Для создания Активных документов в различных средах программирования 
  чаще всего используются Мастера (Wizards), так как структура 
  Активного документа достаточно сложна и его создание &quot;с нуля&quot; затруднительно.</p>
<h3 class=MsoPlainText><a name="003005"></a>Литература</h3>
<ul>
  <li><i>Kraig Brockschmidt &quot;Inside OLE&quot; (2nd 
    edition)</i></li>
  <li><i>Дэвид Чеппел 
    &quot;Технологии ActiveX и OLE&quot;</i></li>
  <li><i>Дейл Роджерсон &quot;Основы COM&quot;</i></li>
  <li><i>Лоуренс Харрис 
    &quot;Освой самостоятельно программирование OLE за 21 день&quot;</i></li>
</ul>
<p>Также можно рекомендовать 
  различные книги по использованным в данной методике 
  средствам программирования (например, серии &quot;... для чайников&quot; или 
  Microsoft Press &quot;Running ...&quot;), так как в них часто приводится необходимая 
  информация, сопровождаемая практическими примерами.</p>
</body>
</html>
