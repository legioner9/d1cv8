<HTML><HEAD>
<META content="text/html; charset=utf-8" http-equiv=Content-Type><LINK rel=stylesheet type=text/css href="v8help://service_book/service_style">
<META name=GENERATOR content="MSHTML 11.00.9600.18922"></HEAD>
<BODY>
<H1>Работа с временными таблицами</H1>
<BLOCKQUOTE style="MARGIN-RIGHT: 0px" dir=ltr>
<P><A href="#Manager">Менеджер временных таблиц</A><BR><A href="#Create">Создание временных таблиц</A><BR><A href="#Used">Использование временных таблиц</A><BR><A href="#Delete">Удаление временных таблиц</A></P></BLOCKQUOTE>
<P>Язык запросов 1С:Предприятия 8 позволяет использовать временные таблицы в запросах. Использование временных таблиц помогает повысить производительность запросов и сделать текст сложных запросов более легким для восприятия.</P>
<P>Работа с временными таблицами обеспечивается двумя составляющими:</P>
<UL>
<LI>объектом встроенного языка <A href="v8help://SyntaxHelperContext/objects/catalog213/catalog393/TempTablesManager.html">МенеджерВременныхТаблиц</A>, который хранит в себе данные временных таблиц; 
<LI>синтаксисом языка запросов, позволяющим создавать новые временные таблицы и использовать существующие временные таблицы.</LI></UL>
<H2><A name=Manager>Менеджер временных таблиц</A></H2>
<P>Менеджер временных таблиц предназначен для управления временем жизни временных таблиц, создаваемых в процессе работы прикладного решения.</P>
<P>В одном прикладном решении может быть создано произвольное количество экземпляров менеджера временных таблиц, каждый из которых хранит свой набор временных таблиц. Каждая временная таблица однозначно идентифицируется своим именем, и в пределах одного менеджера временных таблиц все временные таблицы должны иметь уникальные имена.</P>
<P>Экземпляр менеджера временных таблиц может быть создан с помощью конструктора <STRONG>Новый</STRONG>. Например:</P>
<P>
<TABLE width="100%" bgColor=#f7f7f7>
<TBODY>
<TR>
<TD><FONT color=#ff0000><FONT face="Courier New"><FONT color=#0000ff>МенеджерВременныхТаблиц&nbsp;</FONT><FONT color=#ff0000>=</FONT><FONT color=#ff0000>&nbsp;Новый&nbsp;</FONT><FONT color=#0000ff>МенеджерВременныхТаблиц</FONT><FONT color=#ff0000>;</FONT></FONT></FONT></TD></TR></TBODY></TABLE></P>
<P>Все временные таблицы, созданные в данном экземпляре менеджера, существуют до тех пор, пока существует сам экземпляр менеджера временных таблиц. При уничтожении экземпляра менеджера все временные таблицы, содержащиеся в нем, также удаляются.</P>
<P>Менеджер временных таблиц можно закрыть принудительно при помощи метода <A href="v8help://SyntaxHelperContext/objects/catalog213/catalog393/TempTablesManager/methods/Close2747.html">Закрыть()</A>. При этом будут удалены все созданные в нем таблицы. Дальнейшая работа с данным экземпляром менеджера будет невозможна.</P>
<H2><A name=Create>Создание временных таблиц</A></H2>
<P>Создание временных таблиц осуществляется с помощью объекта <A href="v8help://SyntaxHelperContext/objects/catalog213/catalog393/Query.html">Запрос</A> встроенного языка 1С:Предприятия 8. </P>
<P>Связь запроса с менеджером временных таблиц осуществляется с помощью свойства <A href="v8help://SyntaxHelperContext/objects/catalog213/catalog393/Query/properties/TempTablesManager5775.html">МенеджерВременныхТаблиц</A>&nbsp;запроса, в котором указывается тот экземпляр менеджера, в котором должны создаваться временные таблицы. Например:</P>
<P>
<TABLE width="100%" bgColor=#f7f7f7>
<TBODY>
<TR>
<TD><FONT color=#ff0000><FONT face="Courier New"><FONT color=#0000ff>МенеджерВременныхТаблиц&nbsp;</FONT><FONT color=#ff0000>=</FONT><FONT color=#ff0000>&nbsp;Новый&nbsp;</FONT><FONT color=#0000ff>МенеджерВременныхТаблиц</FONT><FONT color=#ff0000>;</FONT><BR><FONT color=#0000ff>Запрос&nbsp;</FONT><FONT color=#ff0000>=</FONT><FONT color=#ff0000>&nbsp;Новый&nbsp;</FONT><FONT color=#0000ff>Запрос</FONT><FONT color=#ff0000>;</FONT><BR><FONT color=#0000ff>Запрос</FONT><FONT color=#ff0000>.</FONT><FONT color=#0000ff>МенеджерВременныхТаблиц&nbsp;</FONT><FONT color=#ff0000>=</FONT><FONT color=#0000ff>&nbsp;МенеджерВременныхТаблиц</FONT><FONT color=#ff0000>;</FONT></FONT></FONT></TD></TR></TBODY></TABLE></P>
<P>Временная таблица может быть создана на основе данных базы данных или на основе внешнего источника данных (например, таблицы значений).</P>
<P>Для того чтобы создать временную таблицу на основе данных базы данных, следует установить объекту <A href="v8help://SyntaxHelperContext/objects/catalog213/catalog393/Query.html">Запрос</A> менеджер временных таблиц, а затем выполнить запрос к базе данных, используя ключевое слово <A href="v8help://SyntaxHelperQueries/INTO">ПОМЕСТИТЬ</A>, после которого указать имя создаваемой временной таблицы. Ключевое слово <A href="v8help://SyntaxHelperQueries/INTO">ПОМЕСТИТЬ</A>&nbsp;располагается после списка выборки запроса. Например:</P>
<BLOCKQUOTE style="MARGIN-RIGHT: 0px" dir=ltr>
<P><FONT face="Courier New">ВЫБРАТЬ<BR>&nbsp;&nbsp; Код,<BR>&nbsp;&nbsp; Наименование<BR>ПОМЕСТИТЬ ВременнаяТаблица<BR>ИЗ Справочник.Номенклатура</FONT></P></BLOCKQUOTE>
<P>Результат исполнения такого запроса будет содержать одну строку с одной колонкой с именем "Количество", в которой будет находится количество записей, помещенных в созданную таблицу.</P>
<P>В случае если менеджер временных таблиц не установлен, или менеджер был закрыт, будет выдана ошибка.</P>
<P>В случае если в установленном менеджере временных таблиц уже существует таблица с указанным именем, будет выдана ошибка.</P>
<P>При необходимости создания индекса для временной таблицы, следует в запросе указать ключевое слово <A href="v8help://SyntaxHelperQueries/INDEXBY">ИНДЕКСИРОВАТЬ ПО</A>, после которого перечислить поля, по которым нужно построить индекс. </P>
<P>Например:</P>
<BLOCKQUOTE style="MARGIN-RIGHT: 0px" dir=ltr>
<P><FONT face="Courier New">ВЫБРАТЬ<BR>&nbsp;&nbsp; Код,<BR>&nbsp;&nbsp; Наименование<BR>ПОМЕСТИТЬ ВременнаяТаблица<BR>ИЗ Справочник.Номенклатура<BR>ИНДЕКСИРОВАТЬ ПО Код</FONT></P></BLOCKQUOTE>
<P>Поля, по которым происходит индексирование должны находиться в списке выборки.</P>
<P>Чтобы в создаваемой временной таблице создать колонку, значение которой будет уникальным в рамках создаваемой таблицы, следует использовать функцию языка запросов <A href="v8help://SyntaxHelperQueries/RECORDAUTONUMBER">АВТОНОМЕРЗАПИСИ()</A>.</P>
<P>Для того, чтобы создать временную таблицу и заблокировать данные таблиц, на основании которых создается временная, следует использовать конструкцию <A href="v8help://SyntaxHelperQueries/FORUPDATEStatement">ДЛЯ ИЗМЕНЕНИЯ</A>. </P>
<P>Например:</P>
<BLOCKQUOTE style="MARGIN-RIGHT: 0px" dir=ltr>
<P><FONT face="Courier New">ВЫБРАТЬ<BR>&nbsp;&nbsp; РасходнаяНакладная.Ссылка,<BR>&nbsp;&nbsp; РасходнаяНакладная.Номер,<BR>&nbsp;&nbsp; РасходнаяНакладная.Дата<BR>ПОМЕСТИТЬ ВременнаяТаблица<BR>ИЗ<BR>&nbsp;&nbsp; Документ.РасходнаяНакладная КАК РасходнаяНакладная<BR>ГДЕ<BR>&nbsp;&nbsp; РасходнаяНакладная.Ссылка В(&amp;Документы)<BR>&nbsp;<BR>ДЛЯ ИЗМЕНЕНИЯ</FONT></P></BLOCKQUOTE>
<P dir=ltr>Для того чтобы создать временную таблицу на основании внешнего источника, следует в тексте запроса в списке источников указать имя параметра, в который будет помещен внешний источник. Остальной синтаксис идентичен обычному созданию временной таблицы. В качестве внешнего источника могут выступать:</P>
<UL>
<LI>таблица значений; 
<LI>табличная часть; 
<LI>результат запроса.</LI></UL>
<P>Ниже приведен пример создания временной таблицы на основе внешнего источника:</P>
<BLOCKQUOTE style="MARGIN-RIGHT: 0px" dir=ltr>
<P><FONT face="Courier New">ВЫБРАТЬ<BR>&nbsp;&nbsp; Код,<BR>&nbsp;&nbsp; Наименование<BR>ПОМЕСТИТЬ ВременнаяТаблица<BR>ИЗ &amp;ВнешнийИсточник КАК ВнешнийИсточник</FONT></P></BLOCKQUOTE>
<P>В данном примере во временную таблицу "ВременнаяТаблица" будет помещено содержимое колонок "Код" и "Наименование" из внешнего источника, например, таблицы значений, переданной в качестве параметра "ВнешнийИсточник".</P>
<P>В случае если временная таблица создается на основании внешнего источника, в запросе нельзя использовать объединения и соединения. Также нельзя использовать поля, являющиеся реквизитами элементов таблиц, на основании которых создается временная таблица.</P>
<H2><A name=Used>Использование временных таблиц</A></H2>
<P>Для использования существующих временных таблиц в запросе следует установить объекту <A href="v8help://SyntaxHelperContext/objects/catalog213/catalog393/Query.html">Запрос</A> менеджер временных таблиц, после чего к временным таблицам, содержащимся в данном менеджере временных таблиц, можно обращаться по имени, как к обычным таблицам запроса.</P>
<H2><A name=Delete>Удаление временных таблиц</A></H2>
<P>Для удаления временной таблицы из менеджера временных таблиц следует воспользоваться ключевым словом языка запроса <STRONG>УНИЧТОЖИТЬ</STRONG>, после которого указывается имя уничтожаемой таблицы. Например:</P>
<BLOCKQUOTE style="MARGIN-RIGHT: 0px" dir=ltr>
<P><FONT face="Courier New">УНИЧТОЖИТЬ ВременнаяТаблица</FONT></P></BLOCKQUOTE>
<P>В случае если уничтожаемой таблицы не существует, будет выдана ошибка.<BR></P></BODY></HTML>