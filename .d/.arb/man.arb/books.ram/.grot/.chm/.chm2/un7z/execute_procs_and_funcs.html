<HTML><HEAD>
<META content="text/html; charset=utf-8" http-equiv=Content-Type><LINK rel=stylesheet type=text/css href="v8help://service_book/service_style">
<META name=GENERATOR content="MSHTML 8.00.6001.19120"></HEAD>
<BODY>
<H1>Исполнение процедур и функций </H1>
<BLOCKQUOTE style="MARGIN-RIGHT: 0px" dir=ltr>
<P><A href="#ClientServer">В варианте клиент-сервер</A><BR><A href="#FileServer" name="">В файл–серверном варианте</A><BR><A href="#ComConnect">В сессии СОМ-соединения</A><BR><A href="#ThinClient">В тонком клиенте</A><BR><A href="#WebClient">В&nbsp;веб-клиенте</A></P></BLOCKQUOTE>
<P>Настройка использования кода в различных режимах запуска осуществляется с помощью <A href="v8help://SyntaxHelperLanguage/Instructions">инструкций препроцессора</A>.</P>
<H3><A name=ClientServer>В варианте клиент-сервер</A></H3>
<P>Если используется клиент–серверный вариант запуска системы 1С:Предприятие, то можно организовывать выполнение различных процедур и функций на сервере приложения или на клиентском месте.</P>
<P>Для выполнения на сервере:</P>
<P><FONT face="Courier New"><FONT color=#8b2e00>#Если Сервер Тогда<BR>…<BR>#КонецЕсли</FONT></FONT></P>
<P>Для выполнения на клиентском месте:</P>
<P><FONT face="Courier New"><FONT color=#8b2e00>#Если ТолстыйКлиентОбычноеПриложение Тогда<BR>…<BR>#КонецЕсли</FONT></FONT></P>
<P><FONT face="Courier New"><FONT color=#8b2e00>#Если ТолстыйКлиентУправляемоеПриложение Тогда<BR>…<BR>#КонецЕсли</FONT></FONT></P>
<P><FONT face="Courier New"><FONT color=#8b2e00>#Если ТонкийКлиент Тогда<BR>…<BR>#КонецЕсли</FONT></FONT></P>
<P>Для того, чтобы процедура присутствовала и была вызвана на стороне сервера, фрагмент кода должен выглядеть следующим образом: </P>
<P><FONT face="Courier New"><FONT color=#8b2e00>#Если Сервер Тогда <BR>Процедура Проц1() Экспорт <BR>…<BR>КонецПроцедуры <BR>#КонецЕсли </FONT></FONT></P>
<P><STRONG>Важно!</STRONG> В приведенном тексте ВСЯ процедура, а не ее часть находится внутри блока <FONT face="Courier New"><FONT color=#8b2e00>#Если Сервер Тогда … #КонецЕсли</FONT></FONT>. <BR>При запуске конфигурации на выполнение производится загрузка и компиляция конфигурации. Экземпляры всех общих модулей создаются как на серверной, так и на клиентской стороне. Если в каком-то из общих модулей содержится приведенный фрагмент кода, то он в соответствии с инструкцией препроцессора <FONT face="Courier New"><FONT color=#8b2e00>#Если Сервер Тогда … #КонецЕсли</FONT></FONT> будет скомпилирован только на стороне сервера, а на стороне клиента данный фрагмент «выпадет» из компилируемого текста и, таким образом, процедура на стороне клиента не будет представлена совсем. </P>
<P>Далее, при компиляции на стороне клиента модулей, в которых содержится обращение к данной процедуре, будет произведен ее поиск на стороне клиента. На стороне клиента таковой процедуры нет, следовательно, она не будет найдена. Тогда будет произведен поиск процедуры в общих модулях на стороне сервера, где она будет обнаружена и все вызовы будут переправляться для выполнения на сервер 1С:Предприятия. </P>
<P>Если блок <FONT face="Courier New"><FONT color=#8b2e00>#Если Сервер Тогда … #КонецЕсли</FONT></FONT> включает только часть процедуры, то процедура будет присутствовать как на стороне клиента, так и на стороне сервера. Только на клиентской стороне она будет без той части, которая заключена в блок, поэтому результат выполнения процедуры может зависеть от того, где обрабатывается вызов этой процедуры.</P>
<P>Для правильного понимания ситуации в случае использования клиент–серверного варианта информационной базы важным понятием является «экземпляр модуля». Экземпляр модуля содержит скомпилированный код модуля, значения глобальных переменных модуля и т. п. Экземпляры всех общих модулей создаются как на стороне клиента, так и на стороне сервера. Экземпляры модулей таких объектов, как документы или элементы справочников, существуют при своих объектах и могут появляться как на клиентской, так и на серверной стороне, в зависимости от того, где создается тот или иной объект.</P>
<P>Общие модули образуют некоторую общедоступную библиотеку процедур и функций, которые могут быть использованы во всех других модулях. </P>
<P>Предположим, что модуль некоторого объекта, например документа Д, содержит обращение к процедуре П(), определенной в одном из общих модулей. При этом «вокруг» процедуры П() нет никаких операторов препроцессора. В этом случае процедура П() будет содержаться как в экземпляре общего модуля на клиентской стороне, так и в экземпляре общего модуля на серверной стороне. Таким образом, модуль документа, созданного на стороне клиента будет обращаться к процедуре П() из общего модуля на стороне клиента, а модуль документа, созданного на стороне сервера будет обращаться к процедуре общего модуля на стороне сервера. <BR>Теперь предположим, что процедура П() заключена в блок <FONT face="Courier New"><FONT color=#8b2e00>#Если Сервер Тогда … #КонецЕсли</FONT></FONT>. В этом случае экземпляр общего модуля на клиентской стороне не будет содержать процедуру П() и все обращения к ней как со стороны клиента, так и со стороны сервера всегда будет разрешаться за счет экземпляра общего модуля на серверной стороне. То есть все вызовы процедуры П() всегда будут обрабатываться на сервере. </P>
<P>А теперь предположим, что процедура П() заключена в блок <FONT face="Courier New"><FONT color=#8b2e00>#Если ТолстыйКлиентУправляемоеПриложение Тогда … #КонецЕсли</FONT></FONT>. В этом случае экземпляр общего модуля на стороне сервера не будет содержать процедуру П() и обращение к ней будет возможно только на стороне клиента. А экземпляр модуля, содержащий обращение к процедуре П() не сможет быть создан на стороне сервера, так как вызовы клиентских процедур с сервера не поддерживаются и обращение к процедуре П() на серверной стороне останется неразрешенным. </P>
<P>В файловом варианте все намного проще, а именно, клиентская и серверная сторона считаются "слившимися". При компиляции всех модулей Сервер, ТонкийКлиент, ТолстыйКлиентУправляемоеПриложение и ТолстыйКлиентОбычноеПриложение считаются определенными и фрагменты кода, находящиеся внутри блоков <FONT face="Courier New"><FONT color=#8b2e00>#Если Сервер Тогда …</FONT></FONT> <FONT face="Courier New"><FONT color=#8b2e00>#КонецЕсли</FONT></FONT> и <FONT face="Courier New"><FONT color=#8b2e00>#Если ТолстыйКлиентОбычноеПриложение Тогда … #КонецЕсли</FONT></FONT> не будут "вырезаться" при компиляции модулей.</P>
<H3><A name=FileServer>В файл–серверном варианте</A></H3>
<P>В файловом варианте инструкции препроцессора <FONT face="Courier New"><FONT color=#8b2e00>#Если Сервер…</FONT></FONT> или <FONT face="Courier New"><FONT color=#8b2e00>#Если Клиент…</FONT></FONT> пропускаются, поэтому экземпляр кода будет присутствовать всегда.</P>
<H3><A name=ComConnect>В сессии СОМ-соединения</A></H3>
<P>Для включения возможности использования процедур и функций в сессии внешнего соединения применяется инструкция препроцессора </P>
<P><FONT face="Courier New"><FONT color=#8b2e00>#Если ВнешнееСоединение Тогда<BR>…<BR>#КонецЕсли<BR></FONT></FONT></P>
<H3><A name=ThinClient>В тонком клиенте</A></H3>
<P>Для включения возможности использования процедур и функций в тонком клиенте применяется инструкция препроцессора </P>
<P><FONT face="Courier New"><FONT color=#8b2e00>#Если ТонкийКлиент Тогда<BR>…<BR>#КонецЕсли</FONT></FONT></P>
<H3><A name=WebClient>В&nbsp;веб-клиенте</A></H3>
<P>Для включения возможности использования процедур и функций в веб-клиенте применяется инструкция препроцессора </P>
<P><FONT face="Courier New"><FONT color=#8b2e00>#Если ВебКлиент&nbsp;Тогда<BR>…<BR>#КонецЕсли</FONT></FONT></P></BODY></HTML>